<html lang="en-US"><head>
	<meta charset="UTF-8">
			<title>sm-palm-reading</title>
		<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="robots" content="max-image-preview:large">
<title>sm-palm-reading</title>
<link rel="dns-prefetch" href="//cdnjs.cloudflare.com">
<link rel="dns-prefetch" href="//fonts.googleapis.com">
<link rel="alternate" type="application/rss+xml" title="sm-palm-reading ¬ª Feed" href="https://sm-palm-reading.local/feed/">
<link rel="alternate" type="application/rss+xml" title="sm-palm-reading ¬ª Comments Feed" href="https://sm-palm-reading.local/comments/feed/">
<link rel="alternate" title="oEmbed (JSON)" type="application/json+oembed" href="https://sm-palm-reading.local/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fsm-palm-reading.local%2F">
<link rel="alternate" title="oEmbed (XML)" type="text/xml+oembed" href="https://sm-palm-reading.local/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fsm-palm-reading.local%2F&amp;format=xml">
<style id="wp-img-auto-sizes-contain-inline-css">
img:is([sizes=auto i],[sizes^="auto," i]){contain-intrinsic-size:3000px 1500px}
/*# sourceURL=wp-img-auto-sizes-contain-inline-css */
</style>
<style id="wp-emoji-styles-inline-css">

	img.wp-smiley, img.emoji {
		display: inline !important;
		border: none !important;
		box-shadow: none !important;
		height: 1em !important;
		width: 1em !important;
		margin: 0 0.07em !important;
		vertical-align: -0.1em !important;
		background: none !important;
		padding: 0 !important;
	}
/*# sourceURL=wp-emoji-styles-inline-css */
</style>
<style id="wp-block-library-inline-css">
:root{--wp-block-synced-color:#7a00df;--wp-block-synced-color--rgb:122,0,223;--wp-bound-block-color:var(--wp-block-synced-color);--wp-editor-canvas-background:#ddd;--wp-admin-theme-color:#007cba;--wp-admin-theme-color--rgb:0,124,186;--wp-admin-theme-color-darker-10:#006ba1;--wp-admin-theme-color-darker-10--rgb:0,107,160.5;--wp-admin-theme-color-darker-20:#005a87;--wp-admin-theme-color-darker-20--rgb:0,90,135;--wp-admin-border-width-focus:2px}@media (min-resolution:192dpi){:root{--wp-admin-border-width-focus:1.5px}}.wp-element-button{cursor:pointer}:root .has-very-light-gray-background-color{background-color:#eee}:root .has-very-dark-gray-background-color{background-color:#313131}:root .has-very-light-gray-color{color:#eee}:root .has-very-dark-gray-color{color:#313131}:root .has-vivid-green-cyan-to-vivid-cyan-blue-gradient-background{background:linear-gradient(135deg,#00d084,#0693e3)}:root .has-purple-crush-gradient-background{background:linear-gradient(135deg,#34e2e4,#4721fb 50%,#ab1dfe)}:root .has-hazy-dawn-gradient-background{background:linear-gradient(135deg,#faaca8,#dad0ec)}:root .has-subdued-olive-gradient-background{background:linear-gradient(135deg,#fafae1,#67a671)}:root .has-atomic-cream-gradient-background{background:linear-gradient(135deg,#fdd79a,#004a59)}:root .has-nightshade-gradient-background{background:linear-gradient(135deg,#330968,#31cdcf)}:root .has-midnight-gradient-background{background:linear-gradient(135deg,#020381,#2874fc)}:root{--wp--preset--font-size--normal:16px;--wp--preset--font-size--huge:42px}.has-regular-font-size{font-size:1em}.has-larger-font-size{font-size:2.625em}.has-normal-font-size{font-size:var(--wp--preset--font-size--normal)}.has-huge-font-size{font-size:var(--wp--preset--font-size--huge)}.has-text-align-center{text-align:center}.has-text-align-left{text-align:left}.has-text-align-right{text-align:right}.has-fit-text{white-space:nowrap!important}#end-resizable-editor-section{display:none}.aligncenter{clear:both}.items-justified-left{justify-content:flex-start}.items-justified-center{justify-content:center}.items-justified-right{justify-content:flex-end}.items-justified-space-between{justify-content:space-between}.screen-reader-text{border:0;clip-path:inset(50%);height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;width:1px;word-wrap:normal!important}.screen-reader-text:focus{background-color:#ddd;clip-path:none;color:#444;display:block;font-size:1em;height:auto;left:5px;line-height:normal;padding:15px 23px 14px;text-decoration:none;top:5px;width:auto;z-index:100000}html :where(.has-border-color){border-style:solid}html :where([style*=border-top-color]){border-top-style:solid}html :where([style*=border-right-color]){border-right-style:solid}html :where([style*=border-bottom-color]){border-bottom-style:solid}html :where([style*=border-left-color]){border-left-style:solid}html :where([style*=border-width]){border-style:solid}html :where([style*=border-top-width]){border-top-style:solid}html :where([style*=border-right-width]){border-right-style:solid}html :where([style*=border-bottom-width]){border-bottom-style:solid}html :where([style*=border-left-width]){border-left-style:solid}html :where(img[class*=wp-image-]){height:auto;max-width:100%}:where(figure){margin:0 0 1em}html :where(.is-position-sticky){--wp-admin--admin-bar--position-offset:var(--wp-admin--admin-bar--height,0px)}@media screen and (max-width:600px){html :where(.is-position-sticky){--wp-admin--admin-bar--position-offset:0px}}
/*# sourceURL=/wp-includes/css/dist/block-library/common.min.css */
</style>
<style id="global-styles-inline-css">
:root{--wp--preset--aspect-ratio--square: 1;--wp--preset--aspect-ratio--4-3: 4/3;--wp--preset--aspect-ratio--3-4: 3/4;--wp--preset--aspect-ratio--3-2: 3/2;--wp--preset--aspect-ratio--2-3: 2/3;--wp--preset--aspect-ratio--16-9: 16/9;--wp--preset--aspect-ratio--9-16: 9/16;--wp--preset--color--black: #000000;--wp--preset--color--cyan-bluish-gray: #abb8c3;--wp--preset--color--white: #ffffff;--wp--preset--color--pale-pink: #f78da7;--wp--preset--color--vivid-red: #cf2e2e;--wp--preset--color--luminous-vivid-orange: #ff6900;--wp--preset--color--luminous-vivid-amber: #fcb900;--wp--preset--color--light-green-cyan: #7bdcb5;--wp--preset--color--vivid-green-cyan: #00d084;--wp--preset--color--pale-cyan-blue: #8ed1fc;--wp--preset--color--vivid-cyan-blue: #0693e3;--wp--preset--color--vivid-purple: #9b51e0;--wp--preset--color--base: #ffffff;--wp--preset--color--contrast: #000000;--wp--preset--color--primary: #9DFF20;--wp--preset--color--secondary: #345C00;--wp--preset--color--tertiary: #F6F6F6;--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple: linear-gradient(135deg,rgb(6,147,227) 0%,rgb(155,81,224) 100%);--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan: linear-gradient(135deg,rgb(122,220,180) 0%,rgb(0,208,130) 100%);--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange: linear-gradient(135deg,rgb(252,185,0) 0%,rgb(255,105,0) 100%);--wp--preset--gradient--luminous-vivid-orange-to-vivid-red: linear-gradient(135deg,rgb(255,105,0) 0%,rgb(207,46,46) 100%);--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray: linear-gradient(135deg,rgb(238,238,238) 0%,rgb(169,184,195) 100%);--wp--preset--gradient--cool-to-warm-spectrum: linear-gradient(135deg,rgb(74,234,220) 0%,rgb(151,120,209) 20%,rgb(207,42,186) 40%,rgb(238,44,130) 60%,rgb(251,105,98) 80%,rgb(254,248,76) 100%);--wp--preset--gradient--blush-light-purple: linear-gradient(135deg,rgb(255,206,236) 0%,rgb(152,150,240) 100%);--wp--preset--gradient--blush-bordeaux: linear-gradient(135deg,rgb(254,205,165) 0%,rgb(254,45,45) 50%,rgb(107,0,62) 100%);--wp--preset--gradient--luminous-dusk: linear-gradient(135deg,rgb(255,203,112) 0%,rgb(199,81,192) 50%,rgb(65,88,208) 100%);--wp--preset--gradient--pale-ocean: linear-gradient(135deg,rgb(255,245,203) 0%,rgb(182,227,212) 50%,rgb(51,167,181) 100%);--wp--preset--gradient--electric-grass: linear-gradient(135deg,rgb(202,248,128) 0%,rgb(113,206,126) 100%);--wp--preset--gradient--midnight: linear-gradient(135deg,rgb(2,3,129) 0%,rgb(40,116,252) 100%);--wp--preset--font-size--small: clamp(0.875rem, 0.875rem + ((1vw - 0.2rem) * 0.227), 1rem);--wp--preset--font-size--medium: clamp(1rem, 1rem + ((1vw - 0.2rem) * 0.227), 1.125rem);--wp--preset--font-size--large: clamp(1.75rem, 1.75rem + ((1vw - 0.2rem) * 0.227), 1.875rem);--wp--preset--font-size--x-large: 2.25rem;--wp--preset--font-size--xx-large: clamp(6.1rem, 6.1rem + ((1vw - 0.2rem) * 7.091), 10rem);--wp--preset--font-family--dm-sans: "DM Sans", sans-serif;--wp--preset--font-family--ibm-plex-mono: 'IBM Plex Mono', monospace;--wp--preset--font-family--inter: "Inter", sans-serif;--wp--preset--font-family--system-font: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen-Sans,Ubuntu,Cantarell,"Helvetica Neue",sans-serif;--wp--preset--font-family--source-serif-pro: "Source Serif Pro", serif;--wp--preset--spacing--20: 0.44rem;--wp--preset--spacing--30: clamp(1.5rem, 5vw, 2rem);--wp--preset--spacing--40: clamp(1.8rem, 1.8rem + ((1vw - 0.48rem) * 2.885), 3rem);--wp--preset--spacing--50: clamp(2.5rem, 8vw, 4.5rem);--wp--preset--spacing--60: clamp(3.75rem, 10vw, 7rem);--wp--preset--spacing--70: clamp(5rem, 5.25rem + ((1vw - 0.48rem) * 9.096), 8rem);--wp--preset--spacing--80: clamp(7rem, 14vw, 11rem);--wp--preset--shadow--natural: 6px 6px 9px rgba(0, 0, 0, 0.2);--wp--preset--shadow--deep: 12px 12px 50px rgba(0, 0, 0, 0.4);--wp--preset--shadow--sharp: 6px 6px 0px rgba(0, 0, 0, 0.2);--wp--preset--shadow--outlined: 6px 6px 0px -3px rgb(255, 255, 255), 6px 6px rgb(0, 0, 0);--wp--preset--shadow--crisp: 6px 6px 0px rgb(0, 0, 0);}:root { --wp--style--global--content-size: 650px;--wp--style--global--wide-size: 1200px; }:where(body) { margin: 0; }.wp-site-blocks { padding-top: var(--wp--style--root--padding-top); padding-bottom: var(--wp--style--root--padding-bottom); }.has-global-padding { padding-right: var(--wp--style--root--padding-right); padding-left: var(--wp--style--root--padding-left); }.has-global-padding > .alignfull { margin-right: calc(var(--wp--style--root--padding-right) * -1); margin-left: calc(var(--wp--style--root--padding-left) * -1); }.has-global-padding :where(:not(.alignfull.is-layout-flow) > .has-global-padding:not(.wp-block-block, .alignfull)) { padding-right: 0; padding-left: 0; }.has-global-padding :where(:not(.alignfull.is-layout-flow) > .has-global-padding:not(.wp-block-block, .alignfull)) > .alignfull { margin-left: 0; margin-right: 0; }.wp-site-blocks > .alignleft { float: left; margin-right: 2em; }.wp-site-blocks > .alignright { float: right; margin-left: 2em; }.wp-site-blocks > .aligncenter { justify-content: center; margin-left: auto; margin-right: auto; }:where(.wp-site-blocks) > * { margin-block-start: 1.5rem; margin-block-end: 0; }:where(.wp-site-blocks) > :first-child { margin-block-start: 0; }:where(.wp-site-blocks) > :last-child { margin-block-end: 0; }:root { --wp--style--block-gap: 1.5rem; }:root :where(.is-layout-flow) > :first-child{margin-block-start: 0;}:root :where(.is-layout-flow) > :last-child{margin-block-end: 0;}:root :where(.is-layout-flow) > *{margin-block-start: 1.5rem;margin-block-end: 0;}:root :where(.is-layout-constrained) > :first-child{margin-block-start: 0;}:root :where(.is-layout-constrained) > :last-child{margin-block-end: 0;}:root :where(.is-layout-constrained) > *{margin-block-start: 1.5rem;margin-block-end: 0;}:root :where(.is-layout-flex){gap: 1.5rem;}:root :where(.is-layout-grid){gap: 1.5rem;}.is-layout-flow > .alignleft{float: left;margin-inline-start: 0;margin-inline-end: 2em;}.is-layout-flow > .alignright{float: right;margin-inline-start: 2em;margin-inline-end: 0;}.is-layout-flow > .aligncenter{margin-left: auto !important;margin-right: auto !important;}.is-layout-constrained > .alignleft{float: left;margin-inline-start: 0;margin-inline-end: 2em;}.is-layout-constrained > .alignright{float: right;margin-inline-start: 2em;margin-inline-end: 0;}.is-layout-constrained > .aligncenter{margin-left: auto !important;margin-right: auto !important;}.is-layout-constrained > :where(:not(.alignleft):not(.alignright):not(.alignfull)){max-width: var(--wp--style--global--content-size);margin-left: auto !important;margin-right: auto !important;}.is-layout-constrained > .alignwide{max-width: var(--wp--style--global--wide-size);}body .is-layout-flex{display: flex;}.is-layout-flex{flex-wrap: wrap;align-items: center;}.is-layout-flex > :is(*, div){margin: 0;}body .is-layout-grid{display: grid;}.is-layout-grid > :is(*, div){margin: 0;}body{background-color: var(--wp--preset--color--base);color: var(--wp--preset--color--contrast);font-family: var(--wp--preset--font-family--system-font);font-size: var(--wp--preset--font-size--medium);line-height: 1.6;--wp--style--root--padding-top: var(--wp--preset--spacing--40);--wp--style--root--padding-right: var(--wp--preset--spacing--30);--wp--style--root--padding-bottom: var(--wp--preset--spacing--40);--wp--style--root--padding-left: var(--wp--preset--spacing--30);}a:where(:not(.wp-element-button)){color: var(--wp--preset--color--contrast);text-decoration: underline;}:root :where(a:where(:not(.wp-element-button)):hover){text-decoration: none;}:root :where(a:where(:not(.wp-element-button)):focus){text-decoration: underline dashed;}:root :where(a:where(:not(.wp-element-button)):active){color: var(--wp--preset--color--secondary);text-decoration: none;}h1, h2, h3, h4, h5, h6{font-weight: 400;line-height: 1.4;}h1{font-size: clamp(2.032rem, 2.032rem + ((1vw - 0.2rem) * 2.896), 3.625rem);line-height: 1.2;}h2{font-size: clamp(2.625rem, calc(2.625rem + ((1vw - 0.48rem) * 8.4135)), 3.25rem);line-height: 1.2;}h3{font-size: var(--wp--preset--font-size--x-large);}h4{font-size: var(--wp--preset--font-size--large);}h5{font-size: var(--wp--preset--font-size--medium);font-weight: 700;text-transform: uppercase;}h6{font-size: var(--wp--preset--font-size--medium);text-transform: uppercase;}:root :where(.wp-element-button, .wp-block-button__link){background-color: var(--wp--preset--color--primary);border-radius: 0;border-width: 0;color: var(--wp--preset--color--contrast);font-family: inherit;font-size: inherit;font-style: inherit;font-weight: inherit;letter-spacing: inherit;line-height: inherit;padding-top: calc(0.667em + 2px);padding-right: calc(1.333em + 2px);padding-bottom: calc(0.667em + 2px);padding-left: calc(1.333em + 2px);text-decoration: none;text-transform: inherit;}:root :where(.wp-element-button:visited, .wp-block-button__link:visited){color: var(--wp--preset--color--contrast);}:root :where(.wp-element-button:hover, .wp-block-button__link:hover){background-color: var(--wp--preset--color--contrast);color: var(--wp--preset--color--base);}:root :where(.wp-element-button:focus, .wp-block-button__link:focus){background-color: var(--wp--preset--color--contrast);color: var(--wp--preset--color--base);}:root :where(.wp-element-button:active, .wp-block-button__link:active){background-color: var(--wp--preset--color--secondary);color: var(--wp--preset--color--base);}.has-black-color{color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-color{color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-color{color: var(--wp--preset--color--white) !important;}.has-pale-pink-color{color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-color{color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-color{color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-color{color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-color{color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-color{color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-color{color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-color{color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-color{color: var(--wp--preset--color--vivid-purple) !important;}.has-base-color{color: var(--wp--preset--color--base) !important;}.has-contrast-color{color: var(--wp--preset--color--contrast) !important;}.has-primary-color{color: var(--wp--preset--color--primary) !important;}.has-secondary-color{color: var(--wp--preset--color--secondary) !important;}.has-tertiary-color{color: var(--wp--preset--color--tertiary) !important;}.has-black-background-color{background-color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-background-color{background-color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-background-color{background-color: var(--wp--preset--color--white) !important;}.has-pale-pink-background-color{background-color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-background-color{background-color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-background-color{background-color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-background-color{background-color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-background-color{background-color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-background-color{background-color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-background-color{background-color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-background-color{background-color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-background-color{background-color: var(--wp--preset--color--vivid-purple) !important;}.has-base-background-color{background-color: var(--wp--preset--color--base) !important;}.has-contrast-background-color{background-color: var(--wp--preset--color--contrast) !important;}.has-primary-background-color{background-color: var(--wp--preset--color--primary) !important;}.has-secondary-background-color{background-color: var(--wp--preset--color--secondary) !important;}.has-tertiary-background-color{background-color: var(--wp--preset--color--tertiary) !important;}.has-black-border-color{border-color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-border-color{border-color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-border-color{border-color: var(--wp--preset--color--white) !important;}.has-pale-pink-border-color{border-color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-border-color{border-color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-border-color{border-color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-border-color{border-color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-border-color{border-color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-border-color{border-color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-border-color{border-color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-border-color{border-color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-border-color{border-color: var(--wp--preset--color--vivid-purple) !important;}.has-base-border-color{border-color: var(--wp--preset--color--base) !important;}.has-contrast-border-color{border-color: var(--wp--preset--color--contrast) !important;}.has-primary-border-color{border-color: var(--wp--preset--color--primary) !important;}.has-secondary-border-color{border-color: var(--wp--preset--color--secondary) !important;}.has-tertiary-border-color{border-color: var(--wp--preset--color--tertiary) !important;}.has-vivid-cyan-blue-to-vivid-purple-gradient-background{background: var(--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple) !important;}.has-light-green-cyan-to-vivid-green-cyan-gradient-background{background: var(--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan) !important;}.has-luminous-vivid-amber-to-luminous-vivid-orange-gradient-background{background: var(--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange) !important;}.has-luminous-vivid-orange-to-vivid-red-gradient-background{background: var(--wp--preset--gradient--luminous-vivid-orange-to-vivid-red) !important;}.has-very-light-gray-to-cyan-bluish-gray-gradient-background{background: var(--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray) !important;}.has-cool-to-warm-spectrum-gradient-background{background: var(--wp--preset--gradient--cool-to-warm-spectrum) !important;}.has-blush-light-purple-gradient-background{background: var(--wp--preset--gradient--blush-light-purple) !important;}.has-blush-bordeaux-gradient-background{background: var(--wp--preset--gradient--blush-bordeaux) !important;}.has-luminous-dusk-gradient-background{background: var(--wp--preset--gradient--luminous-dusk) !important;}.has-pale-ocean-gradient-background{background: var(--wp--preset--gradient--pale-ocean) !important;}.has-electric-grass-gradient-background{background: var(--wp--preset--gradient--electric-grass) !important;}.has-midnight-gradient-background{background: var(--wp--preset--gradient--midnight) !important;}.has-small-font-size{font-size: var(--wp--preset--font-size--small) !important;}.has-medium-font-size{font-size: var(--wp--preset--font-size--medium) !important;}.has-large-font-size{font-size: var(--wp--preset--font-size--large) !important;}.has-x-large-font-size{font-size: var(--wp--preset--font-size--x-large) !important;}.has-xx-large-font-size{font-size: var(--wp--preset--font-size--xx-large) !important;}.has-dm-sans-font-family{font-family: var(--wp--preset--font-family--dm-sans) !important;}.has-ibm-plex-mono-font-family{font-family: var(--wp--preset--font-family--ibm-plex-mono) !important;}.has-inter-font-family{font-family: var(--wp--preset--font-family--inter) !important;}.has-system-font-font-family{font-family: var(--wp--preset--font-family--system-font) !important;}.has-source-serif-pro-font-family{font-family: var(--wp--preset--font-family--source-serif-pro) !important;}
/*# sourceURL=global-styles-inline-css */
</style>
<style id="wp-block-template-skip-link-inline-css">

		.skip-link.screen-reader-text {
			border: 0;
			clip-path: inset(50%);
			height: 1px;
			margin: -1px;
			overflow: hidden;
			padding: 0;
			position: absolute !important;
			width: 1px;
			word-wrap: normal !important;
		}

		.skip-link.screen-reader-text:focus {
			background-color: #eee;
			clip-path: none;
			color: #444;
			display: block;
			font-size: 1em;
			height: auto;
			left: 5px;
			line-height: normal;
			padding: 15px 23px 14px;
			text-decoration: none;
			top: 5px;
			width: auto;
			z-index: 100000;
		}
/*# sourceURL=wp-block-template-skip-link-inline-css */
</style>
<link rel="stylesheet" id="sm-font-awesome-6-css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css?ver=6.4.0" media="all">
<link rel="stylesheet" id="sm-dashboard-fonts-css" href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&amp;family=Inter:wght@400;500;600;700&amp;display=swap" media="all">
<link rel="stylesheet" id="sm-styles-css" href="https://sm-palm-reading.local/wp-content/plugins/sm-palm-reading/assets/css/styles.css?ver=1.4.5" media="all">
<link rel="stylesheet" id="sm-auth-styles-css" href="https://sm-palm-reading.local/wp-content/plugins/sm-palm-reading/assets/css/auth.css?ver=1.4.5" media="all">
<link rel="stylesheet" id="elementor-frontend-css" href="https://sm-palm-reading.local/wp-content/plugins/elementor/assets/css/frontend.min.css?ver=3.34.0" media="all">
<link rel="stylesheet" id="elementor-post-61-css" href="https://sm-palm-reading.local/wp-content/uploads/elementor/css/post-61.css?ver=1766653007" media="all">
<link rel="stylesheet" id="elementor-post-65-css" href="https://sm-palm-reading.local/wp-content/uploads/elementor/css/post-65.css?ver=1766653007" media="all">
<link rel="stylesheet" id="elementor-gf-roboto-css" href="https://fonts.googleapis.com/css?family=Roboto:100,100italic,200,200italic,300,300italic,400,400italic,500,500italic,600,600italic,700,700italic,800,800italic,900,900italic&amp;display=swap" media="all">
<link rel="stylesheet" id="elementor-gf-robotoslab-css" href="https://fonts.googleapis.com/css?family=Roboto+Slab:100,100italic,200,200italic,300,300italic,400,400italic,500,500italic,600,600italic,700,700italic,800,800italic,900,900italic&amp;display=swap" media="all">
<script src="https://sm-palm-reading.local/wp-includes/js/jquery/jquery.min.js?ver=3.7.1" id="jquery-core-js"></script>
<script src="https://sm-palm-reading.local/wp-includes/js/jquery/jquery-migrate.min.js?ver=3.4.1" id="jquery-migrate-js"></script>
<link rel="https://api.w.org/" href="https://sm-palm-reading.local/wp-json/"><link rel="alternate" title="JSON" type="application/json" href="https://sm-palm-reading.local/wp-json/wp/v2/pages/65"><link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://sm-palm-reading.local/xmlrpc.php?rsd">
<meta name="generator" content="WordPress 6.9">
<link rel="canonical" href="https://sm-palm-reading.local/">
<link rel="shortlink" href="https://sm-palm-reading.local/">
<meta name="generator" content="Elementor 3.34.0; features: e_font_icon_svg, additional_custom_breakpoints; settings: css_print_method-external, google_font-enabled, font_display-swap">
			<style>
				.e-con.e-parent:nth-of-type(n+4):not(.e-lazyloaded):not(.e-no-lazyload),
				.e-con.e-parent:nth-of-type(n+4):not(.e-lazyloaded):not(.e-no-lazyload) * {
					background-image: none !important;
				}
				@media screen and (max-height: 1024px) {
					.e-con.e-parent:nth-of-type(n+3):not(.e-lazyloaded):not(.e-no-lazyload),
					.e-con.e-parent:nth-of-type(n+3):not(.e-lazyloaded):not(.e-no-lazyload) * {
						background-image: none !important;
					}
				}
				@media screen and (max-height: 640px) {
					.e-con.e-parent:nth-of-type(n+2):not(.e-lazyloaded):not(.e-no-lazyload),
					.e-con.e-parent:nth-of-type(n+2):not(.e-lazyloaded):not(.e-no-lazyload) * {
						background-image: none !important;
					}
				}
			</style>
			<style class="wp-fonts-local">
@font-face{font-family:"DM Sans";font-style:normal;font-weight:400;font-display:fallback;src:url('https://sm-palm-reading.local/wp-content/themes/twentytwentythree/assets/fonts/dm-sans/DMSans-Regular.woff2') format('woff2');font-stretch:normal;}
@font-face{font-family:"DM Sans";font-style:italic;font-weight:400;font-display:fallback;src:url('https://sm-palm-reading.local/wp-content/themes/twentytwentythree/assets/fonts/dm-sans/DMSans-Regular-Italic.woff2') format('woff2');font-stretch:normal;}
@font-face{font-family:"DM Sans";font-style:normal;font-weight:700;font-display:fallback;src:url('https://sm-palm-reading.local/wp-content/themes/twentytwentythree/assets/fonts/dm-sans/DMSans-Bold.woff2') format('woff2');font-stretch:normal;}
@font-face{font-family:"DM Sans";font-style:italic;font-weight:700;font-display:fallback;src:url('https://sm-palm-reading.local/wp-content/themes/twentytwentythree/assets/fonts/dm-sans/DMSans-Bold-Italic.woff2') format('woff2');font-stretch:normal;}
@font-face{font-family:"IBM Plex Mono";font-style:normal;font-weight:300;font-display:block;src:url('https://sm-palm-reading.local/wp-content/themes/twentytwentythree/assets/fonts/ibm-plex-mono/IBMPlexMono-Light.woff2') format('woff2');font-stretch:normal;}
@font-face{font-family:"IBM Plex Mono";font-style:normal;font-weight:400;font-display:block;src:url('https://sm-palm-reading.local/wp-content/themes/twentytwentythree/assets/fonts/ibm-plex-mono/IBMPlexMono-Regular.woff2') format('woff2');font-stretch:normal;}
@font-face{font-family:"IBM Plex Mono";font-style:italic;font-weight:400;font-display:block;src:url('https://sm-palm-reading.local/wp-content/themes/twentytwentythree/assets/fonts/ibm-plex-mono/IBMPlexMono-Italic.woff2') format('woff2');font-stretch:normal;}
@font-face{font-family:"IBM Plex Mono";font-style:normal;font-weight:700;font-display:block;src:url('https://sm-palm-reading.local/wp-content/themes/twentytwentythree/assets/fonts/ibm-plex-mono/IBMPlexMono-Bold.woff2') format('woff2');font-stretch:normal;}
@font-face{font-family:Inter;font-style:normal;font-weight:200 900;font-display:fallback;src:url('https://sm-palm-reading.local/wp-content/themes/twentytwentythree/assets/fonts/inter/Inter-VariableFont_slnt,wght.ttf') format('truetype');font-stretch:normal;}
@font-face{font-family:"Source Serif Pro";font-style:normal;font-weight:200 900;font-display:fallback;src:url('https://sm-palm-reading.local/wp-content/themes/twentytwentythree/assets/fonts/source-serif-pro/SourceSerif4Variable-Roman.ttf.woff2') format('woff2');font-stretch:normal;}
@font-face{font-family:"Source Serif Pro";font-style:italic;font-weight:200 900;font-display:fallback;src:url('https://sm-palm-reading.local/wp-content/themes/twentytwentythree/assets/fonts/source-serif-pro/SourceSerif4Variable-Italic.ttf.woff2') format('woff2');font-stretch:normal;}
</style>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover"><script src="https://sm-palm-reading.local/wp-includes/js/wp-emoji-release.min.js?ver=6.9" defer=""></script><style id="sm-dynamic-styles">
      @keyframes ripple-animation {
        to { transform: scale(4); opacity: 0; }
      }
      .btn-unlock.is-loading {
        cursor: wait !important;
        background: var(--mystic-secondary) !important;
        pointer-events: none;
      }
      .btn-unlock.is-loading > * {
        visibility: hidden;
      }
      .btn-unlock.is-loading::after {
        content: '';
        position: absolute;
        width: 20px;
        height: 20px;
        top: 50%;
        left: 50%;
        margin-top: -10px;
        margin-left: -10px;
        border: 3px solid rgba(255, 255, 255, 0.2);
        border-top-color: white;
        border-radius: 50%;
        animation: sm-spinner-anim 0.8s linear infinite;
      }
      @keyframes sm-spinner-anim {
        to { transform: rotate(360deg); }
      }
    </style></head>
<body class="home wp-singular page-template page-template-elementor_canvas page page-id-65 wp-embed-responsive wp-theme-twentytwentythree elementor-default elementor-template-canvas elementor-kit-61 elementor-page elementor-page-65 e--ua-firefox e--ua-mac" data-elementor-device-mode="desktop">
			<div data-elementor-type="wp-page" data-elementor-id="65" class="elementor elementor-65">
				<div class="elementor-element elementor-element-3dd0922 e-con-full e-flex e-con e-parent e-lazyloaded" data-id="3dd0922" data-element_type="container">
				<div class="elementor-element elementor-element-11e1490 elementor-widget__width-inherit elementor-widget elementor-widget-shortcode" data-id="11e1490" data-element_type="widget" data-widget_type="shortcode.default">
							<div class="elementor-shortcode">
<div id="sm-palm-reading-app" class="sm-container" data-app-version="1.4.5">
    <div class="background-animation">
        <div class="star-field"></div>
        <div class="aura-circle shape-1"></div>
        <div class="aura-circle shape-2"></div>
        <div class="aura-circle shape-3"></div>
    </div>

	<div class="app-container">
		<div class="progress-container">
			<div class="progress-bar">
				<div class="progress-fill" style="width: 100%;"></div>
			</div>
			<div class="progress-text">
				<span class="current-step">11</span>
				<span class="step-name">Your Reading</span>
				<span class="total-steps">11</span>
			</div>
		</div>

		<div id="app-content" class="app-content" aria-live="polite" aria-label="Mystic Palm Reading steps" style="opacity: 1; transform: translateX(0px);"><div class="app-step" data-step="10" role="region" aria-labelledby="step-title-10">


  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="robots" content="max-image-preview:large">
  <title>Palm Reading ‚Äì SoulMirror</title>



<!-- RESULT CONTAINER DESIGN -->
<div id="palm-reading-result" class="result-container" data-reading-id="6a11a0f6-bd48-4dfe-a741-f00cabb8eab4" data-lead-id="77c22b67-bb50-4b08-a497-25b0e8ae2316" data-offerings-url="https://sm-palm-reading.local/offerings?show_message=no_more_credits" data-is-logged-in="1" data-has-full-access="1" data-unlock-count="0" data-max-free-unlocks="2" aria-live="polite" data-sm-teaser-initialized="1">
  <!-- Animated mystical background -->
  <div class="mystic-background">
    <div class="aura-pulse aura-1"></div>
    <div class="aura-pulse aura-2"></div>
    <div class="aura-pulse aura-3"></div>
    <div class="energy-orb orb-1"></div>
    <div class="energy-orb orb-2"></div>
    <div class="constellation"></div>
  </div>

  <!-- Main Result Card -->
  <div class="result-card">

    <!-- Header with title -->
    <div class="result-header">
      

      <h1 class="result-title">
        Your SoulMirror Palm Reading
        <span class="result-subtitle">Your teaser reflection ‚Äî a first look beneath the surface</span>
      </h1>

      <div class="header-badge" title="Teaser Preview">
        <span class="badge-text">Teaser</span>
      </div>
    </div>

    <!-- Reading Meta Information -->
    <div class="reading-meta">
      <div class="meta-item">
        <i class="fas fa-user-circle meta-icon" aria-hidden="true"></i>
        <span class="meta-label">Prepared for:</span>
        <span class="meta-value user-name">Seeker</span>
      </div>
      <div class="meta-item">
        <i class="fas fa-calendar-alt meta-icon" aria-hidden="true"></i>
        <span class="meta-label">Date:</span>
        <span class="meta-value current-date">December 26, 2025</span>
      </div>
    </div>

    <!-- NEW: Opening Reflection -->
    <div class="opening-reflection" role="note">
      <div class="opening-icon" aria-hidden="true">
        <i class="fas fa-magic"></i>
      </div>
      <div class="opening-text">
        <h2>Your Hand as a Mirror</h2>
        <p>Your palm holds patterns shaped by experience, intention, and instinct. Seeker, the lines you see are not fixed‚Äîthey shift as you do, responding to choice, resilience, and inner alignment.</p>
        <p class="opening-soft">This teaser captures what rises first: your strongest themes, clearest signals, and the core questions your hand reflects back. The full reading goes deeper, revealing timelines, hidden strengths, and the specific guidance your palm offers for the path ahead.</p>
      </div>
    </div>

    <!-- Reading Content Sections -->
    <div class="reading-content">

      <!-- Foundations of Your Path (Visible) -->
      <section class="reading-section section-life">
        <div class="section-header">
          <div class="section-icon"><i class="fas fa-hand-paper"></i></div>
          <h2>The Foundations of Your Path</h2>
          <div class="section-ornament"></div>
        </div>
        <div class="section-content">
          <p>
            The primary lines in your palm suggest resilience shaped through experience rather than ease. Your life line shows depth and vitality, but also markers of times when you had to recalibrate, trust yourself differently, or build strength from what felt like loss.
          </p>
          <p>
            Your emotional nature runs deep, Seeker, but you don't give access instantly. The heart line reveals discernment‚Äîyou open slowly but completely. When you commit to a path or a person, it's intentional, and that commitment holds weight.
          </p>
          <p>
            There's evidence here of a mind that works through pattern recognition and intuition rather than pure logic. You sense shifts before they become obvious, and this has likely saved you more than once.
          </p>
          <div class="insight-point">
            <i class="fas fa-star insight-icon" aria-hidden="true"></i>
            <span class="insight-text">Core Theme: You evolve through lived experience, not shortcuts. What looks like detours have been building something essential.</span>
          </div>
        </div>
      </section>

      <!-- Love (LOCKED) -->
      <section class="reading-section section-love">
        <div class="section-header">
          <div class="section-icon"><i class="fas fa-heart"></i></div>
          <h2>What Your Love Life Reflects</h2>
          <div class="section-ornament"></div>
        </div>
        <div class="section-content">
          <p>
            Seeker, this insight builds on your earlier reading with deeper clarity and practical direction. Your heart line suggests steady devotion with a cautious opening. You thrive when you feel chosen and seen, but you also need space to process before committing.
          </p>
          <p>
            The most aligned partner offers consistency without pressure, and communicates through action as much as words. When you honor your own pace, your relationships deepen quickly and feel sustainable.
          </p>
        </div></section>

      <!-- Career & Wealth (PARTIAL + Interactive Orbs) -->
      <section class="reading-section section-destiny">
        <div class="section-header">
          <div class="section-icon"><i class="fas fa-briefcase"></i></div>
          <h2>Your Relationship With Success &amp; Money</h2>
          <div class="section-ornament"></div>
        </div>
        <div class="section-content">
          <p>Your palm suggests success grows best through alignment, not pressure. The head line shows strategic thinking and an ability to see around corners, but it also reveals tension when you're working in environments that don't value your instincts. Seeker, career satisfaction for you isn't about title or income alone‚Äîit's about having ownership over the work and seeing direct impact.</p>

          <div class="symbol-grid">
            <button class="symbol-item symbol-btn" type="button" data-modal="lovePatterns" aria-label="Open Love Patterns insight">
              <span class="symbol"><img draggable="false" role="img" class="emoji" alt="üíñ" src="https://s.w.org/images/core/emoji/17.0.2/svg/1f496.svg"></span>
              <span class="symbol-label">Love Patterns</span>
              <span class="symbol-micro">What you crave &amp; avoid</span>
            </button>

            <button class="symbol-item symbol-btn" type="button" data-modal="careerDirection" aria-label="Open Career Direction insight">
              <span class="symbol"><img draggable="false" role="img" class="emoji" alt="üíº" src="https://s.w.org/images/core/emoji/17.0.2/svg/1f4bc.svg"></span>
              <span class="symbol-label">Career Direction</span>
              <span class="symbol-micro">Where you thrive</span>
            </button>

            <button class="symbol-item symbol-btn" type="button" data-modal="lifeAlignment" aria-label="Open Life Alignment insight">
              <span class="symbol"><img draggable="false" role="img" class="emoji" alt="üß≠" src="https://s.w.org/images/core/emoji/17.0.2/svg/1f9ed.svg"></span>
              <span class="symbol-label">Life Alignment</span>
              <span class="symbol-micro">Balance signal</span>
            </button>
          </div>

          <div class="insight-point muted">
            <i class="fas fa-info-circle insight-icon" aria-hidden="true"></i>
            <span class="insight-text">Tip: Tap the icons for quick insights (your ‚Äúmini-reading‚Äù).</span>
          </div>
        </div>
      </section>

      <!-- Personality & Intuition (Visible, keep your original vibe) -->
      <section class="reading-section section-personality">
        <div class="section-header">
          <div class="section-icon"><i class="fas fa-brain"></i></div>
          <h2>How You Think, Feel, and Decide</h2>
          <div class="section-ornament"></div>
        </div>
        <div class="section-content">
          <p>Your hand shape and finger alignment suggest strong intuition paired with practical thinking. You are not purely abstract or purely grounded‚Äîyou move between both, and this dual capacity is one of your greatest strengths. Below are the three core traits most reflected in your palm.</p>

          <div class="trait-list">
            <!-- TRAITS_REPLACE_START -->
<div class="trait-item">
  <span class="trait-name">Intuition</span>
  <div class="trait-bar"><div class="trait-fill visible" style="width: 88%"></div></div>
</div>
<div class="trait-item">
  <span class="trait-name">Resilience</span>
  <div class="trait-bar"><div class="trait-fill visible" style="width: 92%"></div></div>
</div>
<div class="trait-item">
  <span class="trait-name">Independence</span>
  <div class="trait-bar"><div class="trait-fill visible" style="width: 85%"></div></div>
</div>
            <!-- TRAITS_REPLACE_END -->
          </div>
        </div>
      </section>

      <!-- Challenges & Opportunities (LOCKED) - NEW -->
      <section class="reading-section section-challenges">
        <div class="section-header">
          <div class="section-icon"><i class="fas fa-mountain"></i></div>
          <h2>Challenges &amp; Hidden Opportunities</h2>
          <div class="section-ornament"></div>
        </div>
        <div class="section-content">
          <p>
            Seeker, this insight builds on your earlier reading with deeper clarity and practical direction. Your challenge is over-commitment and the urge to prove yourself through constant effort. Your opportunity is discernment: choosing fewer paths so each one can fully bloom.
          </p>
          <p>
            The lines in your palm suggest you are most powerful when you say no early, then invest deeply. This shift turns your energy from scattered to magnetic.
          </p>
        </div></section>

      <!-- Current Life Phase (LOCKED) -->
      <section class="reading-section section-phase">
        <div class="section-header">
          <div class="section-icon"><i class="fas fa-moon"></i></div>
          <h2>The Phase You‚Äôre In Right Now</h2>
          <div class="section-ornament"></div>
        </div>
        <div class="section-content">
          <p>
            Seeker, this insight builds on your earlier reading with deeper clarity and practical direction. You are entering a phase of consolidation and momentum. The patterns show a shift toward clarity after a period of uncertainty, and a return to values that feel rooted.
          </p>
          <p>
            This is a building phase, not a rushing phase. When you slow down, your intuition becomes sharper and your next step feels obvious.
          </p>
        </div></section>

      <!-- Timeline/Next 6 Months (LOCKED) - NEW -->
      <section class="reading-section section-timeline">
        <div class="section-header">
          <div class="section-icon"><i class="fas fa-calendar-check"></i></div>
          <h2>Your Timeline: The Next 6 Months</h2>
          <div class="section-ornament"></div>
        </div>
        <div class="section-content">
          <p>
            Seeker, this insight builds on your earlier reading with deeper clarity and practical direction. The next six months emphasize strategic decisions and boundary-setting. A window opens for a meaningful choice around your work or living situation, followed by a steady rise in confidence.
          </p>
          <p>
            Align your calendar to your highest priorities, and protect your mornings for focused creation. Momentum builds when you keep your energy clean.
          </p>
        </div></section>

      <!-- Guidance (LOCKED) -->
      <section class="reading-section section-guidance">
        <div class="section-header">
          <div class="section-icon"><i class="fas fa-compass"></i></div>
          <h2>What to Pay Attention to Now</h2>
          <div class="section-ornament"></div>
        </div>
        <div class="section-content">
          <div class="guidance-card">
            <div class="guidance-text">
              <h3>Your Focus Points</h3>
              <p>Seeker, this insight builds on your earlier reading with deeper clarity and practical direction. Choose one focus to deepen, one habit to release, and one relationship to nourish. Create a small ritual that signals ‚ÄúI am available for my future,‚Äù even if it takes five minutes a day. Your palm shows that small, consistent actions will compound into big shifts for you.</p>
            </div>
          </div>
        </div></section>

      <!-- NEW PREMIUM LOCKED SECTIONS -->

      <!-- Deep Relationship Analysis (100% Premium Locked) -->
      <section class="reading-section section-deep-love">
        <div class="section-header">
          <div class="section-icon"><i class="fas fa-heart"></i></div>
          <h2>Deep Relationship Analysis</h2>
          <div class="section-ornament"></div>
        </div>
        <div class="section-content">
          <p>
            Seeker, this insight builds on your earlier reading with deeper clarity and practical direction. Your attachment pattern favors depth over volume. You do not connect with many people, but when you do, the bond is real.
          </p>
          <p>
            The most aligned partner will respect your pace, value long-term trust, and show consistency in small, everyday ways. You are most fulfilled when love feels calm and safe, not dramatic. The shift for you is to ask directly for what you need, rather than hoping it will be noticed.
          </p>
        </div><div class="lock-title">Premium Insight</div>
            <div class="lock-sub">Deep analysis of attachment styles, partner compatibility, relationship timing, and love patterns.</div>
            
          </section></div>
        </div>
      

      <!-- 12-Month Extended Timeline (100% Premium Locked) -->
      <section class="reading-section section-extended-timeline">
        <div class="section-header">
          <div class="section-icon"><i class="fas fa-calendar-alt"></i></div>
          <h2>12-Month Extended Timeline</h2>
          <div class="section-ornament"></div>
        </div>
        <div class="section-content">
          <p>
            Seeker, this insight builds on your earlier reading with deeper clarity and practical direction. Over the next year, timing favors steady progress, with a meaningful turning point around the mid-year mark. The first quarter is about clearing space and finishing old obligations.
          </p>
          <p>
            The middle of the year carries a strong opening for a new commitment or role. The final quarter is about refinement, where you integrate what you learned and set a new rhythm.
          </p>
        </div><div class="lock-title">Premium Insight</div>
            <div class="lock-sub">Month-by-month themes, timing for major decisions, and upcoming opportunities mapped to your unique energy.</div>
            
          </section></div>
        
      

      <!-- Life Purpose & Soul Mission (100% Premium Locked) -->
      <section class="reading-section section-life-purpose">
        <div class="section-header">
          <div class="section-icon"><i class="fas fa-star"></i></div>
          <h2>Life Purpose &amp; Soul Mission</h2>
          <div class="section-ornament"></div>
        </div>
        <div class="section-content">
          <p>
            Seeker, this insight builds on your earlier reading with deeper clarity and practical direction. Your purpose centers on creating stability for others while honoring your own creative truth. You are here to build something dependable, whether it is a space, a practice, or a community, while still protecting your independence.
          </p>
          <p>
            Your most fulfilling path blends service with autonomy and allows your intuition to guide the structure. When you create from that place, you feel aligned and energized.
          </p>
        </div><div class="lock-title">Premium Insight</div>
            <div class="lock-sub">Soul purpose, karmic patterns, life mission alignment, and your unique contribution to the world.</div>
            
          
        
      </section>

      <!-- Shadow Work & Transformation (100% Premium Locked) -->
      <section class="reading-section section-shadow-work">
        <div class="section-header">
          <div class="section-icon"><i class="fas fa-moon"></i></div>
          <h2>Shadow Work &amp; Transformation</h2>
          <div class="section-ornament"></div>
        </div>
        <div class="section-content">
          <p>
            Seeker, this insight builds on your earlier reading with deeper clarity and practical direction. The shadow theme is self-doubt disguised as caution. You sometimes delay action while searching for certainty, but the lines in your palm show that movement creates clarity for you.
          </p>
          <p>
            The antidote is action paired with compassionate self-checks: move, evaluate, adjust. This cycle turns fear into wisdom.
          </p>
        </div><div class="lock-title">Premium Insight</div>
            <div class="lock-sub">Shadow patterns, blocks to release, transformation path, and the hidden gifts within your challenges.</div>
            
          
        
      </section>

      <!-- Practical Guidance & Action Plan (100% Premium Locked) -->
      <section class="reading-section section-action-plan">
        <div class="section-header">
          <div class="section-icon"><i class="fas fa-compass"></i></div>
          <h2>Practical Guidance &amp; Action Plan</h2>
          <div class="section-ornament"></div>
        </div>
        <div class="section-content">
          <p>
            Seeker, this insight builds on your earlier reading with deeper clarity and practical direction. Commit to three actions: protect your mornings for focused work, complete one meaningful project before starting another, and schedule consistent rest. Choose one person to share your goals with, and meet weekly for accountability.
          </p>
          <p>
            This simple structure aligns with your palm‚Äôs indication of steady, long-term success.
          </p>
        </div><div class="lock-title">Premium Insight</div>
            <div class="lock-sub">3 specific focus points, daily/weekly rituals, practices tailored to your energy, and an accountability framework.</div>
            
          
        
      </section>

      <!-- Closing (Updated with Premium CTA) -->
      <section class="reading-section section-closing">
        <div class="section-header">
          <div class="section-icon"><i class="fas fa-eye"></i></div>
          <h2>This Is Only the First Reflection</h2>
          <div class="section-ornament"></div>
        </div>
        <div class="section-content">
          <p>This teaser captures what rises first: your strongest themes, clearest patterns, and the questions your palm reflects back. The full reading reveals deeper layers‚Äîtimelines, hidden strengths, and the specific next steps your hand suggests.</p>
          <p class="closing-soft">If you're ready, Seeker, reveal the full meaning and see what your palm is truly pointing toward.</p>
          <ul class="premium-benefits-list">
            <li><i class="fas fa-heart premium-icon"></i> Deep relationship patterns and compatibility insights</li>
            <li><i class="fas fa-calendar-alt premium-icon"></i> Extended 12-month timeline with monthly themes</li>
            <li><i class="fas fa-star premium-icon"></i> Your soul purpose and life mission alignment</li>
            <li><i class="fas fa-moon premium-icon"></i> Shadow work and transformation guidance</li>
            <li><i class="fas fa-compass premium-icon"></i> Personalized action plan with daily practices</li>
          </ul>
        </div>
      </section>

    

    <!-- Report Action -->
    <div class="report-action">
      <div class="report-action__copy">
        <span class="report-action__eyebrow">Your next step</span>
        <h3 class="report-action__title">Continue your journey</h3>
        <p class="report-action__body">Unlock the full reading to reveal your deeper patterns and next moves.</p>
      </div>
      <a class="action-btn btn-primary report-action__btn" href="#" data-report-cta="">
        <i class="fas fa-gem"></i> Unlock Full Report
      </a>
    </div>

    <!-- Footer Note -->
    <div class="result-footer">
      <p class="footer-note">
        <i class="fas fa-magic footer-icon" aria-hidden="true"></i>
        This teaser is generated using AI analysis of palm features and your answers. For entertainment purposes only.
      </p>
    </div>

  


<!-- Modal (for icon popups) -->


<style>
/* RESULT CONTAINER STYLES */
#palm-reading-result {
  --mystic-primary: #9c7ae7;
  --mystic-secondary: #6c63ff;
  --mystic-accent: #ff6b9d;
  --mystic-dark: #2a2342;
  --mystic-light: #f8f7ff;
  --mystic-glow: rgba(156, 122, 231, 0.15);

  position: relative;
  width: 100%;
  max-width: 900px;
  margin: 2rem auto;
  font-family: var(--wp--preset--font-family--body, "Inter", sans-serif);
  color: var(--wp--preset--color--contrast, #111111);
  animation: fadeInUp 0.8s ease-out;
}

/* Mystical Background Elements */
.mystic-background {
  position: absolute;
  top: 0; left: 0;
  width: 100%; height: 100%;
  z-index: -1;
  overflow: hidden;
  border-radius: 20px;
  pointer-events: none;
}

.aura-pulse {
  position: absolute;
  border-radius: 50%;
  background: radial-gradient(circle, var(--mystic-glow) 0%, transparent 70%);
  animation: pulse 8s infinite ease-in-out;
}
.aura-1 {
  width: 300px; height: 300px;
  top: -100px; right: -100px;
  animation-delay: 0s;
  background: radial-gradient(circle, rgba(108, 99, 255, 0.1) 0%, transparent 70%);
}
.aura-2 {
  width: 200px; height: 200px;
  bottom: -50px; left: -50px;
  animation-delay: 2s;
  background: radial-gradient(circle, rgba(255, 107, 157, 0.08) 0%, transparent 70%);
}
.aura-3 {
  width: 400px; height: 400px;
  top: 50%; left: 50%;
  transform: translate(-50%, -50%);
  animation-delay: 4s;
  background: radial-gradient(circle, rgba(156, 122, 231, 0.05) 0%, transparent 70%);
}

.energy-orb {
  position: absolute;
  width: 20px; height: 20px;
  border-radius: 50%;
  filter: blur(1px);
  animation: float 6s infinite ease-in-out;
}
.orb-1 {
  background: var(--mystic-primary);
  top: 20%; right: 15%;
  animation-delay: 1s;
}
.orb-2 {
  background: var(--mystic-accent);
  bottom: 30%; left: 10%;
  animation-delay: 3s;
}

.constellation {
  position: absolute;
  width: 100%; height: 100%;
  background-image:
    radial-gradient(circle at 20% 30%, rgba(255, 255, 255, 0.1) 1px, transparent 2px),
    radial-gradient(circle at 80% 70%, rgba(255, 255, 255, 0.1) 1px, transparent 2px),
    radial-gradient(circle at 40% 80%, rgba(255, 255, 255, 0.1) 1px, transparent 2px);
  background-size: 100px 100px, 120px 120px, 80px 80px;
  opacity: 0.3;
}

/* Main Result Card */
.result-card {
  background: rgba(255, 255, 255, 0.92);
  backdrop-filter: blur(10px);
  border-radius: 20px;
  padding: 2.5rem;
  box-shadow:
    0 20px 40px rgba(42, 35, 66, 0.1),
    0 8px 32px rgba(156, 122, 231, 0.15),
    inset 0 0 0 1px rgba(255, 255, 255, 0.4);
  border: 1px solid rgba(255, 255, 255, 0.8);
  position: relative;
  overflow: hidden;
}
.result-card::before {
  content: '';
  position: absolute;
  top: 0; left: 0; right: 0;
  height: 4px;
  background: linear-gradient(90deg, var(--mystic-primary), var(--mystic-secondary), var(--mystic-accent));
  z-index: 2;
}

/* Header Styles */
.result-header {
  display: flex;
  align-items: center;
  gap: 1.5rem;
  margin-bottom: 2rem;
  position: relative;
}
.header-icon {
  width: 70px; height: 70px;
  background: linear-gradient(135deg, var(--mystic-primary), var(--mystic-secondary));
  border-radius: 18px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  box-shadow: 0 8px 20px rgba(156, 122, 231, 0.3);
  flex-shrink: 0;
}
.mystic-icon { width: 40px; height: 40px; }
.result-title {
  flex: 1;
  font-family: var(--wp--preset--font-family--heading, "Cardo", serif);
  font-size: clamp(1.8rem, 3vw, 2.5rem);
  font-weight: 700;
  color: var(--mystic-dark);
  margin: 0;
  line-height: 1.2;
}
.result-subtitle {
  display: block;
  font-family: var(--wp--preset--font-family--body, "Inter", sans-serif);
  font-size: 1rem;
  font-weight: 400;
  color: var(--mystic-secondary);
  margin-top: 0.5rem;
  letter-spacing: 0.02em;
}
.header-badge {
  background: linear-gradient(135deg, var(--mystic-primary), var(--mystic-secondary));
  padding: 0.5rem 1.2rem;
  border-radius: 30px;
  color: white;
  font-weight: 700;
  font-size: 0.85rem;
  letter-spacing: 0.05em;
  text-transform: uppercase;
  box-shadow: 0 4px 12px rgba(156, 122, 231, 0.3);
  white-space: nowrap;
}

/* Reading Meta */
.reading-meta {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 1.5rem;
  background: var(--mystic-light);
  padding: 1.5rem;
  border-radius: 12px;
  margin-bottom: 2rem;
  border: 1px solid rgba(108, 99, 255, 0.1);
}
.meta-item { display: flex; align-items: center; gap: 0.75rem; }
.meta-icon { color: var(--mystic-primary); font-size: 1.1rem; }
.meta-label { font-weight: 600; color: var(--mystic-dark); font-size: 0.9rem; opacity: 0.8; }
.meta-value { font-weight: 700; color: var(--mystic-secondary); margin-left: 0.25rem; }

/* NEW: Opening Reflection */
.opening-reflection {
  display: flex;
  gap: 1.25rem;
  align-items: flex-start;
  background: linear-gradient(135deg, rgba(156, 122, 231, 0.06), rgba(255, 107, 157, 0.05));
  border: 1px solid rgba(156, 122, 231, 0.15);
  border-radius: 16px;
  padding: 1.5rem;
  margin-bottom: 2.5rem;
}
.opening-icon {
  width: 56px; height: 56px;
  border-radius: 14px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  background: linear-gradient(135deg, var(--mystic-primary), var(--mystic-accent));
  box-shadow: 0 8px 18px rgba(156, 122, 231, 0.25);
  flex-shrink: 0;
  font-size: 1.2rem;
}
.opening-text h2 {
  margin: 0 0 0.5rem 0;
  font-family: var(--wp--preset--font-family--heading, "Cardo", serif);
  color: var(--mystic-dark);
  font-size: 1.35rem;
}
.opening-text p { margin: 0 0 0.75rem 0; color: #444; line-height: 1.65; }
.opening-soft { opacity: 0.9; }

/* Reading Sections */
.reading-content { display: flex; flex-direction: column; gap: 2.5rem; }
.reading-section {
  background: white;
  border-radius: 16px;
  padding: 1.8rem;
  border: 1px solid rgba(108, 99, 255, 0.1);
  transition: transform 0.3s ease, box-shadow 0.3s ease;
  position: relative;
  overflow: hidden;
}
.reading-section:hover { transform: translateY(-4px); box-shadow: 0 12px 24px rgba(108, 99, 255, 0.15); }
.reading-section::before {
  content: '';
  position: absolute;
  top: 0; left: 0;
  width: 4px; height: 100%;
  background: linear-gradient(to bottom, var(--mystic-primary), var(--mystic-accent));
}
.section-header {
  display: flex;
  align-items: center;
  gap: 1rem;
  margin-bottom: 1.5rem;
  position: relative;
  z-index: 2;
}
.section-icon {
  width: 50px; height: 50px;
  background: linear-gradient(135deg, var(--mystic-primary), var(--mystic-secondary));
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-size: 1.2rem;
}
.reading-section h2 {
  font-family: var(--wp--preset--font-family--heading, "Cardo", serif);
  font-size: 1.5rem;
  color: var(--mystic-dark);
  margin: 0;
  flex: 1;
}
.section-ornament { width: 40px; height: 2px; background: linear-gradient(90deg, var(--mystic-primary), transparent); }
.section-content { color: #444; line-height: 1.7; font-size: 1.05rem; }
.insight-point {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  margin-top: 1.25rem;
  padding: 1rem;
  background: linear-gradient(90deg, rgba(156, 122, 231, 0.1), transparent);
  border-left: 3px solid var(--mystic-accent);
  border-radius: 0 8px 8px 0;
}
.insight-point.muted { border-left-color: rgba(108, 99, 255, 0.35); opacity: 0.95; }
.insight-icon { color: var(--mystic-accent); font-size: 1.2rem; }
.insight-point.muted .insight-icon { color: var(--mystic-secondary); }
.insight-text { font-weight: 600; color: var(--mystic-dark); }

/* Symbol Grid -> clickable buttons */
.symbol-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 1rem;
  margin-top: 1.5rem;
}
.symbol-item {
  text-align: center;
  padding: 1rem;
  background: var(--mystic-light);
  border-radius: 10px;
  transition: transform 0.3s ease, box-shadow 0.3s ease;
  border: 0;
  cursor: pointer;
  width: 100%;
}
.symbol-item:hover { transform: translateY(-3px); background: white; box-shadow: 0 6px 12px rgba(108, 99, 255, 0.1); }
.symbol { font-size: 2rem; margin-bottom: 0.25rem; display: block; }
.symbol-label { font-size: 0.95rem; font-weight: 700; color: var(--mystic-secondary); display: block; }
.symbol-micro { font-size: 0.85rem; color: #666; display: block; margin-top: 0.35rem; }

/* Trait Visualization */
.trait-list { margin-top: 1.5rem; }
.trait-item { margin-bottom: 1rem; }
.trait-name { display: block; font-weight: 600; color: var(--mystic-dark); margin-bottom: 0.5rem; }
.trait-bar { height: 8px; background: rgba(108, 99, 255, 0.1); border-radius: 4px; overflow: hidden; }
.trait-fill { height: 100%; background: linear-gradient(90deg, var(--mystic-primary), var(--mystic-accent)); border-radius: 4px; transition: width 1.5s ease-out; }

/* Guidance Card */
.guidance-card {
  display: flex;
  align-items: center;
  gap: 1.5rem;
  padding: 1.5rem;
  background: linear-gradient(135deg, rgba(156, 122, 231, 0.05), rgba(108, 99, 255, 0.05));
  border-radius: 12px;
  border: 1px solid rgba(156, 122, 231, 0.2);
}
.guidance-icon {
  width: 60px; height: 60px;
  background: linear-gradient(135deg, var(--mystic-primary), var(--mystic-secondary));
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-size: 1.5rem;
  flex-shrink: 0;
}
.guidance-text h3 { color: var(--mystic-dark); margin: 0 0 0.5rem 0; font-size: 1.2rem; }
.guidance-text p { color: #666; margin: 0; line-height: 1.6; }

/* NEW: Locked sections (blur + overlay) */
.locked .section-content {
  filter: blur(7px);
  user-select: none;
  pointer-events: none;
  opacity: 0.95;
}
.lock-overlay {
  position: absolute;
  inset: 0;
  display: flex;
  align-items: flex-end;
  justify-content: center;
  padding: 1.25rem;
  pointer-events: auto;
  background: radial-gradient(circle at 50% 30%, rgba(255,255,255,0.35) 0%, rgba(255,255,255,0.0) 55%);
  z-index: 1;
}
.lock-card {
  width: min(520px, 100%);
  pointer-events: auto;
  background: rgba(255,255,255,0.92);
  border: 1px solid rgba(156, 122, 231, 0.2);
  border-radius: 16px;
  padding: 1.1rem 1.1rem;
  box-shadow: 0 16px 30px rgba(42, 35, 66, 0.12);
  text-align: center;
}
.lock-counter {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  margin: 0.6rem auto 0.4rem;
  padding: 0.3rem 0.75rem;
  border-radius: 999px;
  background: rgba(108, 99, 255, 0.12);
  color: var(--mystic-secondary);
  font-size: 0.8rem;
  font-weight: 600;
}
.lock-title {
  font-weight: 800;
  color: var(--mystic-dark);
  display: inline-flex;
  gap: 0.6rem;
  align-items: center;
  justify-content: center;
  margin-bottom: 0.35rem;
}
.lock-sub { color: #555; margin-bottom: 0.9rem; font-size: 0.95rem; }

/* Premium Locked Sections */
.premium-locked .section-content {
  filter: blur(10px);
  opacity: 0.7;
}
.premium-locked .lock-overlay {
  top: 0;
  align-items: flex-start;
  padding-top: calc(50px + 2.25rem);
}
.premium-lock-card {
  background: #ffffff;
  border: 2px solid rgba(255,193,7,0.4);
  box-shadow: 0 20px 40px rgba(255,193,7,0.15), 0 8px 16px rgba(42, 35, 66, 0.1);
}
.lock-icon-premium {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 48px;
  height: 48px;
  border-radius: 50%;
  background: linear-gradient(135deg, #ffd700, #ffa500);
  color: white;
  font-size: 1.5rem;
  margin-bottom: 0.75rem;
  box-shadow: 0 6px 16px rgba(255,193,7,0.35);
}
.placeholder-text {
  opacity: 0.5;
  font-style: italic;
  color: #888;
  user-select: none;
}
.premium-benefits-list {
  list-style: none;
  padding: 0;
  margin: 1.5rem 0 0 0;
}
.report-action {
  margin-top: 2.25rem;
  padding: 1.75rem 1.6rem;
  border-radius: 18px;
  background: linear-gradient(135deg, rgba(156, 122, 231, 0.16), rgba(255, 107, 157, 0.12));
  border: 1px solid rgba(156, 122, 231, 0.25);
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 1.5rem;
}
.report-action__eyebrow {
  text-transform: uppercase;
  letter-spacing: 0.18em;
  font-size: 0.7rem;
  color: rgba(42, 35, 66, 0.6);
  font-weight: 700;
}
.report-action__title {
  margin: 0.35rem 0 0.4rem 0;
  font-family: var(--wp--preset--font-family--heading, "Cardo", serif);
  font-size: 1.4rem;
  color: var(--mystic-dark);
}
.report-action__body {
  margin: 0;
  color: #5a516b;
  font-size: 0.98rem;
}
.report-action__btn {
  min-width: 220px;
  text-align: center;
}
.premium-benefits-list li {
  padding: 0.75rem 0;
  display: flex;
  align-items: flex-start;
  gap: 0.75rem;
  border-bottom: 1px solid rgba(108, 99, 255, 0.1);
}
.premium-benefits-list li:last-child {
  border-bottom: none;
}
.premium-icon {
  color: #ffa500;
  font-size: 1.2rem;
  margin-top: 0.1rem;
  flex-shrink: 0;
}

/* Action Buttons */
.result-actions {
  display: flex;
  gap: 1rem;
  margin-top: 3rem;
  flex-wrap: wrap;
}
.action-btn {
  flex: 1;
  min-width: 150px;
  padding: 1rem 1.5rem;
  border: none;
  border-radius: 12px;
  font-weight: 700;
  font-size: 1rem !important;
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.75rem;
  letter-spacing: 0.02em;
  position: relative;
  overflow: hidden;
}
.action-btn i {
  flex-shrink: 0;
}
.btn-unlock {
  color: white !important;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen-Sans, Ubuntu, Cantarell, "Helvetica Neue", sans-serif !important;
}
.btn-primary {
  background: linear-gradient(135deg, var(--mystic-primary), var(--mystic-secondary));
  color: white;
  box-shadow: 0 6px 16px rgba(156, 122, 231, 0.3);
}
.btn-primary:hover { transform: translateY(-3px); box-shadow: 0 10px 24px rgba(156, 122, 231, 0.4); }
.btn-premium {
  background: linear-gradient(135deg, #ffd700 0%, #ffa500 100%);
  color: #2a2342 !important;
  box-shadow: 0 6px 20px rgba(255,193,7,0.4);
  font-weight: 800;
}
.btn-premium:hover {
  transform: translateY(-3px);
  box-shadow: 0 10px 28px rgba(255,193,7,0.5);
  background: linear-gradient(135deg, #ffed4e 0%, #ffb84d 100%);
}
.btn-secondary {
  background: white;
  color: var(--mystic-primary);
  border: 2px solid var(--mystic-primary);
}
.btn-secondary:hover {
  background: linear-gradient(135deg, var(--mystic-primary), var(--mystic-secondary));
  color: white;
  transform: translateY(-3px);
}
.btn-outline {
  background: transparent;
  color: var(--mystic-dark);
  border: 2px solid var(--mystic-light);
}
.btn-outline:hover { border-color: var(--mystic-primary); background: var(--mystic-light); transform: translateY(-3px); }

/* Footer Note */
.result-footer {
  margin-top: 2rem;
  padding-top: 1.5rem;
  border-top: 1px solid rgba(108, 99, 255, 0.1);
  text-align: center;
}
.footer-note {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.75rem;
  color: #666;
  font-size: 0.9rem;
  margin: 0;
}
.footer-icon { color: var(--mystic-primary); }

/* Modal - Simplified, bulletproof positioning */
.sm-modal {
  position: fixed !important;
  inset: 0 !important;
  z-index: 999999 !important;
  display: none !important; /* becomes flex when open */
  align-items: center;
  justify-content: center;
  padding: 3vh 1rem;
  margin: 0 !important;
  width: 100% !important;
  height: 100% !important;
  pointer-events: none; /* Allow clicks to pass through when closed */
}
.sm-modal.is-open {
  display: flex !important;
  pointer-events: auto; /* Enable clicks when open */
}
.sm-modal__backdrop {
  position: fixed !important;
  inset: 0 !important;
  z-index: 1 !important; /* Behind panel */
  background: rgba(42, 35, 66, 0.75); /* Darker for better contrast */
  backdrop-filter: blur(12px) !important; /* Stronger blur for better focus */
  -webkit-backdrop-filter: blur(12px) !important;
  cursor: pointer; /* Indicate clickable */
}
.sm-modal__panel {
  position: relative !important;
  z-index: 2 !important; /* Above backdrop */
  width: min(560px, calc(100% - 2rem)) !important;
  max-height: 85vh !important;
  overflow-y: auto !important;
  background: rgba(255,255,255,0.98); /* Slightly more opaque */
  border-radius: 18px;
  box-shadow: 0 25px 60px rgba(0,0,0,0.35); /* Stronger shadow */
  border: 1px solid rgba(156, 122, 231, 0.3);
  padding: 1.25rem 1.25rem 1.35rem;
  margin: 0 !important;
  pointer-events: auto; /* Ensure panel is clickable */
}

/* Mobile: Position from top with margin */
@media (max-width: 768px) {
  .sm-modal {
    align-items: flex-start;
    padding-top: 6vh;
  }
  .sm-modal__panel {
    width: calc(100% - 2.5rem) !important;
    max-height: 85vh !important;
    padding: 1rem !important;
    border-radius: 16px;
  }
}

/* Desktop: Centered vertically and horizontally */
@media (min-width: 769px) {
  .sm-modal { align-items: center; }
}

/* REMOVED: Duplicate blur rules that were causing stacking issues */
/* Modal blur is now handled ONLY by the backdrop element above */
/* This prevents z-index and pointer-events conflicts */
.sm-modal__close {
  position: absolute;
  top: 12px; right: 12px;
  width: 42px; height: 42px;
  border-radius: 12px;
  border: 1px solid rgba(108, 99, 255, 0.15);
  background: white;
  cursor: pointer;
  z-index: 3;
}
.sm-modal__close:hover {
  background: #f5f5f5;
  transform: scale(1.05);
  transition: all 0.2s ease;
}
.sm-modal__badge {
  display: inline-block;
  align-self: flex-start;
  padding: 0.35rem 0.7rem;
  border-radius: 999px;
  background: linear-gradient(135deg, rgba(156, 122, 231, 0.18), rgba(255, 107, 157, 0.15));
  color: #1a1429; /* Darker, stronger color for better contrast */
  font-weight: 900; /* Increased weight for stronger appearance */
  font-size: 0.85rem; /* Slightly larger for better readability */
  letter-spacing: 0.03em;
  margin-bottom: 0.8rem;
  text-transform: uppercase; /* Adds visual weight */
}
.sm-modal__title {
  margin: 0 0 0.6rem 0;
  font-family: var(--wp--preset--font-family--heading, "Cardo", serif);
  color: var(--mystic-dark);
  font-size: 1.5rem;
}
.sm-modal__body { margin: 0; color: #444; line-height: 1.7; font-size: 1.02rem; }
.sm-modal__hint { margin-top: 0.95rem; color: #666; font-size: 0.92rem; }
.sm-modal__counter {
  margin-top: 0.85rem;
  display: inline-flex;
  align-items: center;
  gap: 0.6rem;
  padding: 0.35rem 0.75rem;
  border-radius: 999px;
  background: rgba(255, 193, 7, 0.16);
  color: #6a4c00;
  font-size: 0.85rem;
  font-weight: 600;
}
.sm-modal__counter-label { text-transform: uppercase; letter-spacing: 0.08em; font-size: 0.7rem; }
.sm-modal__actions {
  margin-top: 1.4rem;
  display: flex;
  flex-wrap: wrap;
  gap: 0.75rem;
}
.btn-ghost {
  background: transparent;
  border: 1px solid rgba(108, 99, 255, 0.4);
  color: #3f36b6;
}
.btn-ghost:hover {
  background: rgba(108, 99, 255, 0.08);
}

/* Animations */
@keyframes fadeInUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
@keyframes pulse { 0%, 100% { opacity: 0.3; transform: scale(1); } 50% { opacity: 0.6; transform: scale(1.05); } }
@keyframes float { 0%, 100% { transform: translateY(0) rotate(0deg); } 50% { transform: translateY(-20px) rotate(180deg); } }

/* Responsive */
@media (max-width: 768px) {
  .result-card { padding: 1.5rem; }
  .result-header { flex-direction: column; text-align: center; gap: 1rem; }
  .header-icon { width: 60px; height: 60px; }
  .result-title { font-size: 1.8rem; }
  .reading-meta { grid-template-columns: 1fr; }
  .section-header { flex-direction: column; text-align: center; }
  .guidance-card { flex-direction: column; text-align: center; }
  .result-actions { flex-direction: column; }
  .action-btn { min-width: 100%; }
  .opening-reflection { flex-direction: column; text-align: left; }
  .premium-locked .lock-overlay { padding-top: calc(70px + 3.5rem); }
  .report-action { flex-direction: column; text-align: left; align-items: flex-start; }
  .report-action__btn { width: 100%; }
  .sm-modal__actions { width: 100%; }
  .sm-modal__actions .action-btn { width: 100%; }
}
@media (max-width: 480px) {
  .result-card { padding: 1.25rem; }
  .symbol-grid { grid-template-columns: 1fr; }
  .reading-section { padding: 1.25rem; }
  .premium-locked .lock-overlay { padding-top: calc(80px + 3.75rem); }
}

/* Print */
@media print {
  .mystic-background, .result-actions, .header-badge, .lock-overlay, .sm-modal { display: none !important; }
  .result-card { box-shadow: none; border: 1px solid #ddd; }
  .reading-section:hover { transform: none; box-shadow: none; }
  .locked .section-content { filter: none; }
}
</style>


<!-- JavaScript for teaser reading interactions is loaded externally via assets/js/teaser-reading.js -->



</div></div>

		<div class="navigation">
			<button id="back-btn" class="btn btn-secondary" type="button" aria-label="Go to previous step" style="display: flex; visibility: visible; padding: 0.9rem 1.6rem; font-size: 1rem;" data-default-padding="0.9rem 1.6rem" data-default-font-size="1rem">
				<i class="fas fa-chevron-left"></i>
				Back			</button>
			<button id="next-btn" class="btn btn-primary" type="button" aria-label="Go to next step" style="display: none; padding: 0.9rem 1.6rem; font-size: 1rem;" data-default-padding="0.9rem 1.6rem" data-default-font-size="1rem">Continue <i class="fas fa-chevron-right"></i></button>
		</div>

		<div id="toast" class="toast" role="status" aria-live="polite">Photo captured! Ready to continue.</div>
	</div>
</div>
</div>
						</div>
				</div>
				</div>
		<script type="speculationrules">
{"prefetch":[{"source":"document","where":{"and":[{"href_matches":"/*"},{"not":{"href_matches":["/wp-*.php","/wp-admin/*","/wp-content/uploads/*","/wp-content/*","/wp-content/plugins/*","/wp-content/themes/twentytwentythree/*","/*\\?(.+)"]}},{"not":{"selector_matches":"a[rel~=\"nofollow\"]"}},{"not":{"selector_matches":".no-prefetch, .no-prefetch a"}}]},"eagerness":"conservative"}]}
</script>
			<script>
				const lazyloadRunObserver = () => {
					const lazyloadBackgrounds = document.querySelectorAll( `.e-con.e-parent:not(.e-lazyloaded)` );
					const lazyloadBackgroundObserver = new IntersectionObserver( ( entries ) => {
						entries.forEach( ( entry ) => {
							if ( entry.isIntersecting ) {
								let lazyloadBackground = entry.target;
								if( lazyloadBackground ) {
									lazyloadBackground.classList.add( 'e-lazyloaded' );
								}
								lazyloadBackgroundObserver.unobserve( entry.target );
							}
						});
					}, { rootMargin: '200px 0px 200px 0px' } );
					lazyloadBackgrounds.forEach( ( lazyloadBackground ) => {
						lazyloadBackgroundObserver.observe( lazyloadBackground );
					} );
				};
				const events = [
					'DOMContentLoaded',
					'elementor/lazyload/observe',
				];
				events.forEach( ( event ) => {
					document.addEventListener( event, lazyloadRunObserver );
				} );
			</script>
			<script id="wp-block-template-skip-link-js-after">
	( function() {
		var skipLinkTarget = document.querySelector( 'main' ),
			sibling,
			skipLinkTargetID,
			skipLink;

		// Early exit if a skip-link target can't be located.
		if ( ! skipLinkTarget ) {
			return;
		}

		/*
		 * Get the site wrapper.
		 * The skip-link will be injected in the beginning of it.
		 */
		sibling = document.querySelector( '.wp-site-blocks' );

		// Early exit if the root element was not found.
		if ( ! sibling ) {
			return;
		}

		// Get the skip-link target's ID, and generate one if it doesn't exist.
		skipLinkTargetID = skipLinkTarget.id;
		if ( ! skipLinkTargetID ) {
			skipLinkTargetID = 'wp--skip-link--target';
			skipLinkTarget.id = skipLinkTargetID;
		}

		// Create the skip link.
		skipLink = document.createElement( 'a' );
		skipLink.classList.add( 'skip-link', 'screen-reader-text' );
		skipLink.id = 'wp-skip-link';
		skipLink.href = '#' + skipLinkTargetID;
		skipLink.innerText = 'Skip to content';

		// Inject the skip link.
		sibling.parentElement.insertBefore( skipLink, sibling );
	}() );
	
//# sourceURL=wp-block-template-skip-link-js-after
</script>
<script id="sm-teaser-reading-js-after">
/**
 * Teaser Reading Initialization
 *
 * This script initializes all interactive elements in the palm reading teaser template.
 * It listens for a custom event 'sm:teaser_loaded' which is fired after the
 * teaser HTML is injected into the DOM by the main application script.
 */
function smClearReadingSession() {
  try {
    sessionStorage.removeItem('sm_reading_loaded');
    sessionStorage.removeItem('sm_reading_lead_id');
    sessionStorage.removeItem('sm_reading_token');
    sessionStorage.removeItem('sm_existing_reading_id');
    sessionStorage.removeItem('sm_email');
    sessionStorage.removeItem('sm_flow_step_id');
    sessionStorage.removeItem('sm_lead_cache');
  } catch (error) {
    console.warn('[SM Teaser] Failed to clear reading session:', error);
  }
}

window.addEventListener('pageshow', function () {
  if (sessionStorage.getItem('sm_paywall_redirect') === '1') {
    sessionStorage.removeItem('sm_paywall_redirect');
    const returnUrl = sessionStorage.getItem('sm_paywall_return_url');
    sessionStorage.removeItem('sm_paywall_return_url');
    if (returnUrl && !window.location.search.includes('sm_report=1')) {
      window.location.replace(returnUrl);
    }
  }
});

document.addEventListener('sm:teaser_loaded', function () {
  console.log('[SM Teaser] Event sm:teaser_loaded received. Initializing interactions...');

  const resultContainer = document.getElementById('palm-reading-result');
  if (!resultContainer) {
    console.error('[SM Teaser] Initialization failed: Result container #palm-reading-result not found in the DOM.');
    return;
  }
  if (resultContainer.dataset.smTeaserInitialized === '1') {
    console.log('[SM Teaser] Initialization skipped: already initialized for this render.');
    return;
  }
  resultContainer.dataset.smTeaserInitialized = '1';

  // Set current date
  const dateElement = resultContainer.querySelector('.current-date');
  if (dateElement) {
    const now = new Date();
    const options = { year: 'numeric', month: 'long', day: 'numeric' };
    dateElement.textContent = now.toLocaleDateString('en-US', options);
  }

  // Animate trait bars on scroll into view
  const observerOptions = { threshold: 0.3, rootMargin: '0px 0px -50px 0px' };
  const traitObserver = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        entry.target.classList.add('visible');
        traitObserver.unobserve(entry.target);
      }
    });
  }, observerOptions);

  const traitBars = resultContainer.querySelectorAll('.trait-fill');
  traitBars.forEach(bar => traitObserver.observe(bar));

  // Modal handling
  // Modal lives outside the result container; grab it from either context and relocate to body to avoid transform stacking quirks.
  let modal = resultContainer.querySelector('.sm-modal') || document.getElementById('sm-modal');
  if (modal && modal.parentElement !== document.body) {
    document.body.appendChild(modal);
  }

  const modalContent = {
    lovePatterns: {
      badge: 'Mini Reading',
      title: 'Love Patterns',
      body: 'This is a quick reflection. Unlock the full reading to see the deeper layers behind your relationship themes.',
      hint: 'Your full report connects the dots between every section.',
      showCta: false,
      showCounter: false
    },
    careerDirection: {
      badge: 'Mini Reading',
      title: 'Career Direction',
      body: 'This is a quick reflection. Unlock the full report to reveal the full path and timing behind this insight.',
      hint: 'Upgrade to unlock every section and timeline.',
      showCta: false,
      showCounter: false
    },
    lifeAlignment: {
      badge: 'Mini Reading',
      title: 'Life Alignment',
      body: 'This is a quick reflection. The full reading shows the guidance that supports this insight.',
      hint: 'Unlock the full report to see everything at once.',
      showCta: false,
      showCounter: false
    },
    limitReached: {
      badge: 'Free Unlocks Used',
      title: 'You have reached your free unlock limit',
      body: 'You have revealed all free sections. Upgrade to unlock the full report and see every hidden insight instantly.',
      hint: 'Full access includes premium sections, timelines, and guidance.',
      ctaText: 'Unlock Full Report',
      showCta: true,
      showCounter: true
    },
    premiumLocked: {
      badge: 'Premium Insight',
      title: 'This section is premium-only',
      body: 'These insights are part of the full reading experience. Unlock the complete report to access premium sections and deeper guidance.',
      hint: 'Upgrade now to see the full story behind your palm.',
      ctaText: 'View Plans',
      showCta: true,
      showCounter: true
    }
  };

  const root = document.documentElement;
  let scrollY = 0; // Store scroll position when modal opens
  let openedOnMobile = false; // Track whether modal opened on mobile sizing

  const unlockCountRaw = resultContainer.dataset.unlockCount || '0';
  const maxFreeUnlocksRaw = resultContainer.dataset.maxFreeUnlocks || '2';
  let unlockCount = Number.parseInt(unlockCountRaw, 10);
  const maxFreeUnlocks = Number.parseInt(maxFreeUnlocksRaw, 10);

  function getUnlocksRemaining() {
    if (!Number.isFinite(unlockCount) || !Number.isFinite(maxFreeUnlocks)) {
      return 0;
    }
    return Math.max(0, maxFreeUnlocks - unlockCount);
  }

  function formatUnlockStatus() {
    const remaining = getUnlocksRemaining();
    if (remaining <= 0) {
      return "You've reached your unlock limit";
    }
    if (remaining === 1) {
      return 'You have 1 unlock remaining';
    }
    return `You have ${remaining} unlocks remaining`;
  }

  function formatUnlockBadge() {
    if (!Number.isFinite(maxFreeUnlocks)) {
      return 'Free unlocks available';
    }
    const remaining = getUnlocksRemaining();
    return `Free unlocks: ${remaining} of ${maxFreeUnlocks} remaining`;
  }

  function updateUnlockIndicators() {
    if (!Number.isFinite(maxFreeUnlocks) || hasFullAccess) {
      return;
    }
    const badgeText = formatUnlockBadge();
    const badges = resultContainer.querySelectorAll('[data-unlock-badge]');
    badges.forEach((badge) => {
      badge.textContent = badgeText;
    });
  }

  function updateModalCounter() {
    if (!modal) return;
    const counterWrap = modal.querySelector('[data-unlock-counter]');
    if (!counterWrap) return;
    const labelEl = counterWrap.querySelector('.sm-modal__counter-label');
    const valueEl = counterWrap.querySelector('[data-unlock-remaining]');
    if (labelEl && Number.isFinite(maxFreeUnlocks)) {
      labelEl.textContent = `You can unlock up to ${maxFreeUnlocks} sections`;
    }
    if (valueEl) {
      valueEl.textContent = formatUnlockStatus();
    }
  }

  function openModal(key) {
    if (!modal || !modalContent[key]) return;
    const content = modalContent[key];
    const badgeEl = modal.querySelector('#sm-modal-badge');
    const titleEl = modal.querySelector('.sm-modal__title');
    const bodyEl = modal.querySelector('.sm-modal__body');
    const hintEl = modal.querySelector('#sm-modal-hint');
    const ctaButton = modal.querySelector('[data-cta]');
    const counterWrap = modal.querySelector('[data-unlock-counter]');
    if (badgeEl && content.badge) badgeEl.textContent = content.badge;
    if (titleEl) titleEl.textContent = content.title;
    if (bodyEl) bodyEl.textContent = content.body;
    if (hintEl) hintEl.textContent = content.hint || '';

    if (ctaButton) {
      if (content.showCta) {
        const ctaLabel = content.ctaText || 'View Plans';
        ctaButton.innerHTML = `<i class="fas fa-crown"></i> ${ctaLabel}`;
        ctaButton.style.display = '';
      } else {
        ctaButton.style.display = 'none';
      }
    }

    if (counterWrap) {
      if (content.showCounter) {
        counterWrap.style.display = 'inline-flex';
        updateModalCounter();
      } else {
        counterWrap.style.display = 'none';
      }
    }

    // Store current scroll position before any adjustments
    scrollY = window.scrollY || window.pageYOffset || 0;
    openedOnMobile = window.innerWidth <= 768;

    // On mobile: Scroll to top smoothly before showing modal to ensure visibility
    if (openedOnMobile && scrollY > 0) {
      window.scrollTo({
        top: 0,
        behavior: 'smooth'
      });
      // Wait for scroll to settle before showing modal
      setTimeout(() => {
        showModal();
      }, 320);
    } else {
      showModal();
    }
  }

  function lockScroll() {
    if (openedOnMobile) {
      // Mobile: avoid fixed positioning issues, just lock overflow on both roots
      root.style.overflow = 'hidden';
      document.body.style.overflow = 'hidden';
    } else {
      // Desktop: preserve position while locking scroll
      document.body.style.position = 'fixed';
      document.body.style.top = `-${scrollY}px`;
      document.body.style.width = '100%';
      document.body.style.overflow = 'hidden';
      root.style.overflow = 'hidden';
    }
  }

  function unlockScroll() {
    if (openedOnMobile) {
      root.style.overflow = '';
      document.body.style.overflow = '';
    } else {
      document.body.style.position = '';
      document.body.style.top = '';
      document.body.style.width = '';
      document.body.style.overflow = '';
      root.style.overflow = '';
    }

    // Restore scroll position
    window.scrollTo(0, scrollY);
  }

  function showModal() {
    // Lock scroll to prevent background movement
    lockScroll();
    modal.classList.add('is-open');
    // Note: Blur is now handled purely by CSS backdrop-filter on .sm-modal__backdrop
    // No need to add/remove blur classes on parent elements
  }

  function closeModal() {
    if (!modal) return;
    modal.classList.remove('is-open');

    // Restore scroll + overflow state
    unlockScroll();
    // Note: No blur removal needed - handled by CSS
  }

  // Attach modal triggers using event delegation on the container
  resultContainer.addEventListener('click', function(e) {
    const trigger = e.target.closest('.symbol-btn');
    if (trigger) {
      openModal(trigger.getAttribute('data-modal'));
    }
  });

  // Close modal on backdrop click or close button
  if (modal) {
    modal.addEventListener('click', (e) => {
      const closer = e.target ? e.target.closest('[data-close]') : null;
      if (closer) {
        closeModal();
      }
    });
  }

  // Close modal on Escape key
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && modal && modal.classList.contains('is-open')) {
      closeModal();
    }
  });

  // --- Unlock Logic ---

  const readingId = resultContainer.dataset.readingId;
  const leadId = resultContainer.dataset.leadId;
  const offeringsRedirect = (resultContainer.dataset.offeringsUrl && resultContainer.dataset.offeringsUrl.trim())
    || (window.smData && window.smData.offeringsUrl ? window.smData.offeringsUrl : '');
  const isLoggedIn = resultContainer.dataset.isLoggedIn === '1';
  const hasFullAccess = resultContainer.dataset.hasFullAccess === '1';
  const nonce = window.smData ? window.smData.nonce : null;
  const unlockedSections = new Set();

  // Debugging: Log the values to see what's missing
  console.log('[SM Teaser] Initializing Unlock Logic...');
  console.log('[SM Teaser] readingId from dataset:', readingId);
  console.log('[SM Teaser] leadId from dataset:', leadId);
  console.log('[SM Teaser] Nonce from smData:', nonce);
  console.log('[SM Teaser] offeringsRedirect resolved:', offeringsRedirect);
  if (!offeringsRedirect) {
    console.error('[SM Teaser] Missing offerings redirect URL. Check smData.offeringsUrl or template data attribute.');
  }

  function redirectToOfferings(reason, targetUrl) {
    const destination = (targetUrl && String(targetUrl).trim()) ? String(targetUrl).trim() : offeringsRedirect;
    if (!destination) {
      console.error('[SM Teaser] Redirect suppressed (missing offerings URL).', reason || '');
      return;
    }
    sessionStorage.setItem('sm_paywall_redirect', '1');
    sessionStorage.setItem('sm_paywall_return_url', window.location.href);
    window.location.href = destination;
  }

  // 1. Initialize state from DOM on load
  function initializeUnlockState() {
    const sections = resultContainer.querySelectorAll('[data-lock]');
    sections.forEach(section => {
      if (!section.classList.contains('locked')) {
        const key = section.dataset.lock;
        if (key) {
          unlockedSections.add(key);
        }
      }
    });
    console.log('[SM Teaser] Initial unlocked sections:', [...unlockedSections]);
  }

  // 2. Visual unlock function (reused from original)
  function unlockSection(key) {
    const section = resultContainer.querySelector(`[data-lock="${key}"]`);
    if (!section) {
      console.warn('[SM Teaser] Section to unlock not found:', key);
      return;
    }
    
    if (!section.classList.contains('locked')) {
        console.log('[SM Teaser] Section already visually unlocked:', key);
        return; // Already unlocked
    }

    console.log('[SM Teaser] Visually unlocking section:', key);
    section.classList.remove('locked');
    const overlay = section.querySelector('.lock-overlay');
    if (overlay) {
       overlay.style.transition = 'opacity 0.3s ease-out';
       overlay.style.opacity = '0';
       setTimeout(() => overlay.remove(), 300);
    }
  }

  // 3. API-driven unlock handler
  async function handleUnlockAttempt(key, buttonEl) {
    if (!key) {
      console.warn('[SM Teaser] Unlock key missing on button.');
      return;
    }

    if (!readingId || !nonce) {
      console.error('[SM Teaser] Missing readingId or nonce. Cannot proceed with unlock. Redirecting to offerings page.');
      redirectToOfferings('missing_reading_or_nonce');
      return;
    }

    if (unlockedSections.has(key)) {
      console.log('[SM Teaser] Section already unlocked:', key);
      return;
    }

    buttonEl.classList.add('is-loading');
    buttonEl.disabled = true;

    try {
      const response = await fetch('/wp-json/soulmirror/v1/reading/unlock', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'X-WP-Nonce': nonce
        },
        body: JSON.stringify({
          reading_id: readingId,
          lead_id: leadId,
          section_name: key
        }),
      });

      if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
      }

      const result = await response.json();
      console.log('[SM Teaser] Unlock API response:', result);

      // Check for backend-level success and the presence of the data object
      if (result.success && result.data) {
        const data = result.data;
        if (data.status === 'unlocked') {
          unlockSection(key);
          unlockedSections.add(key);
          if (Number.isFinite(unlockCount)) {
            unlockCount += 1;
          }
          updateUnlockIndicators();
        } else if (data.status === 'limit_reached') {
          console.log('[SM Teaser] Unlock limit reached. Showing modal...');
          openModal('limitReached');
        } else if (data.status === 'premium_locked') {
          console.log('[SM Teaser] Premium section requires purchase. Showing modal...');
          openModal('premiumLocked');
        } else if (data.status === 'already_unlocked') {
          console.log('[SM Teaser] Section was already unlocked on backend.');
          unlockSection(key); // Ensure UI is consistent
          unlockedSections.add(key);
        } else if (data.status === 'unlocked_all') {
          console.log('[SM Teaser] User has full access (purchased reading).');
          unlockSection(key); // Unlock the requested section
          unlockedSections.add(key);
          updateUnlockIndicators();
        } else {
          // Handle cases where data.status is something unexpected
          console.warn('[SM Teaser] Unknown unlock status:', data.status, data);
          throw new Error(data.message || 'An unknown success response was received.');
        }
      } else {
        // Handle cases where success is false or data is missing
        throw new Error(result.message || 'An unknown error occurred.');
      }

    } catch (error) {
      console.error('[SM Teaser] Unlock request failed:', error);
      console.log('[SM Teaser] Redirecting to offerings page due to error.');
      redirectToOfferings('unlock_error');
    } finally {
      buttonEl.classList.remove('is-loading');
      buttonEl.disabled = false;
    }
  }

  // 4. Attach unlock button listeners
  console.log('[SM Teaser] Setting up API-driven unlock button listener.');
  resultContainer.addEventListener('click', function(e) {
      const unlockButton = e.target.closest('.btn-unlock');
      if (unlockButton && !unlockButton.classList.contains('is-loading')) {
          e.preventDefault();
          e.stopPropagation();
          const key = unlockButton.getAttribute('data-unlock');
          console.log('[SM Teaser] Unlock button clicked for section:', key);
          handleUnlockAttempt(key, unlockButton);
      }
  });

  // 5. Run initialization
  initializeUnlockState();
  updateUnlockIndicators();

  // Report CTA setup
  const reportCta = resultContainer.querySelector('[data-report-cta]');
  const reportCopyTitle = resultContainer.querySelector('.report-action__title');
  const reportCopyBody = resultContainer.querySelector('.report-action__body');
  if (reportCta) {
    if (isLoggedIn && hasFullAccess) {
      reportCta.innerHTML = '<i class="fas fa-arrow-left"></i> Back to Dashboard';
      reportCta.href = `${window.location.origin}${window.location.pathname}`;
      if (reportCopyTitle) reportCopyTitle.textContent = 'Return to your dashboard';
      if (reportCopyBody) reportCopyBody.textContent = 'Pick up another reading or revisit your saved insights.';
    } else {
      reportCta.innerHTML = '<i class="fas fa-crown"></i> Unlock Full Report';
      reportCta.href = offeringsRedirect || '#';
      if (reportCopyTitle) reportCopyTitle.textContent = 'Go deeper with the full report';
      if (reportCopyBody) reportCopyBody.textContent = 'Unlock premium insights, full timelines, and your personalized action plan.';
    }
    reportCta.addEventListener('click', (event) => {
      if (isLoggedIn && hasFullAccess) {
        return;
      }
      event.preventDefault();
      redirectToOfferings('report_cta');
    });
  }

  if (modal) {
    const ctaButton = modal.querySelector('[data-cta]');
    if (ctaButton) {
      ctaButton.addEventListener('click', () => {
        closeModal();
        redirectToOfferings('modal_cta');
      });
    }
  }


  // Ripple effect on buttons (also using event delegation)
  resultContainer.addEventListener('click', function(e) {
      const button = e.target.closest('.action-btn');
      if (button && !button.classList.contains('is-loading')) { // Don't ripple while loading
          const ripple = document.createElement('span');
          const rect = button.getBoundingClientRect();
          const size = Math.max(rect.width, rect.height);
          const x = e.clientX - rect.left - size / 2;
          const y = e.clientY - rect.top - size / 2;

          ripple.style.cssText = `
              position: absolute;
              width: ${size}px;
              height: ${size}px;
              border-radius: 50%;
              background: rgba(255,255,255,0.5);
              animation: ripple-animation 0.6s ease-out;
              top: ${y}px;
              left: ${x}px;
              pointer-events: none;
          `;
          button.appendChild(ripple);

          setTimeout(() => ripple.remove(), 600);
      }
  });

  // Add dynamic styles for ripple and loading spinner
  if (!document.getElementById('sm-dynamic-styles')) {
    const style = document.createElement('style');
    style.id = 'sm-dynamic-styles';
    style.textContent = `
      @keyframes ripple-animation {
        to { transform: scale(4); opacity: 0; }
      }
      .btn-unlock.is-loading {
        cursor: wait !important;
        background: var(--mystic-secondary) !important;
        pointer-events: none;
      }
      .btn-unlock.is-loading > * {
        visibility: hidden;
      }
      .btn-unlock.is-loading::after {
        content: '';
        position: absolute;
        width: 20px;
        height: 20px;
        top: 50%;
        left: 50%;
        margin-top: -10px;
        margin-left: -10px;
        border: 3px solid rgba(255, 255, 255, 0.2);
        border-top-color: white;
        border-radius: 50%;
        animation: sm-spinner-anim 0.8s linear infinite;
      }
      @keyframes sm-spinner-anim {
        to { transform: rotate(360deg); }
      }
    `;
    document.head.appendChild(style);
  }

  console.log('[SM Teaser] Initialization complete!');
});

console.log('[SM Teaser] teaser-reading.js loaded and event listener is waiting.');

//# sourceURL=sm-teaser-reading-js-after
</script>
<script id="sm-script-js-extra">
var smData = {"nonce":"f4611d4eac","nonceExpiresIn":"86400","nonceRefreshUrl":"https://sm-palm-reading.local/wp-json/soulmirror/v1/nonce/refresh","apiUrl":"https://sm-palm-reading.local/wp-json/soulmirror/v1/","pluginUrl":"https://sm-palm-reading.local/wp-content/plugins/sm-palm-reading/","homeUrl":"https://sm-palm-reading.local/","offeringsUrl":"https://sm-palm-reading.local/offerings?show_message=no_more_credits","isLoggedIn":"1","accountIntegrationEnabled":"1","auth":{"showLoginButton":false,"loginUrl":"","loginText":"Login / Sign Up"}};
//# sourceURL=sm-script-js-extra
</script>
<script src="https://sm-palm-reading.local/wp-content/plugins/sm-palm-reading/assets/js/script.js?ver=1.4.5" id="sm-script-js"></script>
<script id="sm-api-integration-js-after">
/**
 * API Integration for Mystic Palm Reading AI
 *
 * This file bridges the frontend UI (script.js) with the WordPress REST API backend.
 * It intercepts the UI flow and makes real API calls to:
 * - Create leads
 * - Send and verify OTP
 * - Upload palm images
 * - Save quiz responses
 * - Generate AI readings
 *
 * @requires script.js (must be loaded first)
 * @requires smData (WordPress localized data with nonce and apiUrl)
 */

(function () {
    'use strict';

    // Verify required dependencies
    if (typeof smData === 'undefined') {
        console.error('[SM API] smData is not defined. Make sure wp_localize_script is working.');
        return;
    }

    if (typeof appState === 'undefined') {
        console.error('[SM API] appState is not defined. Make sure script.js is loaded first.');
        return;
    }

    // API Integration State
    const apiState = {
        leadId: null,
        otpSent: false,
        otpVerified: false,
        imageUploaded: false,
        quizSaved: false,
        readingGenerated: false,
        processingRequest: false,
        dynamicQuestions: [],
        demographics: {
            ageRange: '',
            gender: ''
        }
    };
    let magicLinkHandled = false;
    let teaserEventDispatched = false; // New flag to prevent duplicate teaser events
    const STORAGE_KEY = 'sm_lead_cache';
    const STEP_STORAGE_KEY = 'sm_flow_step_id';

    // Cache only lead_id in session storage (clears when browser closes)
    function persistLeadCache(data) {
        try {
            if (!data || !data.leadId) {
                sessionStorage.removeItem(STORAGE_KEY);
                return;
            }
            sessionStorage.setItem(STORAGE_KEY, JSON.stringify({ leadId: data.leadId }));
        } catch (e) {
            logError('Persist lead cache failed', e);
        }
    }

    function readLeadCache() {
        try {
            const raw = sessionStorage.getItem(STORAGE_KEY);
            if (!raw) return null;
            return JSON.parse(raw);
        } catch (e) {
            logError('Read lead cache failed', e);
            return null;
        }
    }

    function resetApiState() {
        apiState.leadId = null;
        apiState.otpSent = false;
        apiState.otpVerified = false;
        apiState.imageUploaded = false;
        apiState.quizSaved = false;
        apiState.readingGenerated = false;
        apiState.processingRequest = false;
        apiState.dynamicQuestions = [];
        apiState.demographics = { ageRange: '', gender: '' };
        teaserEventDispatched = false; // Reset the flag when API state is reset
    }

    function clearClientSession() {
        try {
            sessionStorage.removeItem(STORAGE_KEY);
            sessionStorage.removeItem(STEP_STORAGE_KEY);
            sessionStorage.removeItem('sm_reading_lead_id');
            sessionStorage.removeItem('sm_existing_reading_id');
            sessionStorage.removeItem('sm_reading_token');
            sessionStorage.removeItem('sm_reading_loaded');
            sessionStorage.removeItem('sm_email');
            teaserEventDispatched = false; // Also reset here for comprehensive reset
        } catch (e) {
            logError('Clear client session failed', e);
        }
    }

    function resetFlowState(jumpToWelcome = true) {
        resetApiState();
        magicLinkHandled = false; // Reset magic link flag too
        appState.userData = {
            name: '',
            email: '',
            identity: '',
            age: '',
            ageRange: '',
            gdprConsent: false,
            palmImage: null,
            emailVerified: false
        };
        appState.dynamicQuestions = [];
        appState.quizResponses = {};
        clearClientSession();
        if (typeof resetLeadCaptureValidationState === 'function') {
            resetLeadCaptureValidationState();
        }
        if (jumpToWelcome && window.appContent && typeof window.renderStep === 'function') {
            window.renderStep(0);
        } else if (jumpToWelcome) {
            log('Skipped renderStep reset; #app-content not available.');
        }
    }

    let magicOverlay = null;

    function showMagicOverlay() {
        if (magicOverlay) {
            return;
        }
        const overlay = document.createElement('div');
        overlay.style.position = 'fixed';
        overlay.style.top = '0';
        overlay.style.left = '0';
        overlay.style.right = '0';
        overlay.style.bottom = '0';
        overlay.style.background = 'rgba(11, 15, 23, 0.85)';
        overlay.style.zIndex = '9999';
        overlay.style.display = 'flex';
        overlay.style.alignItems = 'center';
        overlay.style.justifyContent = 'center';
        overlay.style.color = '#fff';
        overlay.style.fontFamily = 'sans-serif';
        overlay.innerHTML = '<div style="text-align:center;"><div class="loading-spinner" style="margin-bottom:12px;"></div><div>Preparing your reading...</div></div>';
        document.body.appendChild(overlay);
        magicOverlay = overlay;
    }

    function hideMagicOverlay() {
        if (!magicOverlay) {
            return;
        }
        magicOverlay.remove();
        magicOverlay = null;
    }

    function jumpToStepWhenReady(stepId, attemptsLeft = 15) {
        if (!window.appContent || typeof window.renderStep !== 'function' || typeof palmReadingConfig === 'undefined') {
            if (attemptsLeft > 0) {
                setTimeout(() => jumpToStepWhenReady(stepId, attemptsLeft - 1), 150);
            } else {
                log('Unable to jump to step; app not ready.', { stepId });
            }
            return false;
        }

        const stepIndex = palmReadingConfig.steps.findIndex(s => s.id === stepId);
        if (stepIndex < 0) {
            log('Unable to jump to step; step id not found.', { stepId });
            return false;
        }

        window.renderStep(stepIndex);
        return true;
    }

    function enforceStepAfterInit(stepId, attemptsLeft = 20) {
        if (attemptsLeft <= 0) {
            return;
        }

        if (!window.appContent || typeof window.renderStep !== 'function' || typeof palmReadingConfig === 'undefined') {
            setTimeout(() => enforceStepAfterInit(stepId, attemptsLeft - 1), 200);
            return;
        }

        const stepIndex = palmReadingConfig.steps.findIndex(s => s.id === stepId);
        if (stepIndex < 0) {
            log('Unable to enforce step; step id not found.', { stepId });
            return;
        }

        if (typeof appState === 'undefined' || appState.currentStep !== stepIndex) {
            window.renderStep(stepIndex);
        }

        setTimeout(() => enforceStepAfterInit(stepId, attemptsLeft - 1), 200);
    }

    let currentOtpKeyListener = null; // Global to manage the OTP Enter key listener

    function wrapRenderStepForRestore() {
        if (typeof window.renderStep !== 'function' || window.renderStep._smWrapped) {
            return;
        }

        const original = window.renderStep;
        window.renderStep = function (stepIndex) {
            // --- FIX for Enter key submission ---
            // Always remove previous listener to prevent duplicates and ensure it's clean
            if (currentOtpKeyListener) {
                document.removeEventListener('keydown', currentOtpKeyListener);
                currentOtpKeyListener = null;
            }
            // --- END FIX ---

            const result = original(stepIndex);
            try {
                if (typeof palmReadingConfig !== 'undefined' && palmReadingConfig.steps[stepIndex]) {
                    sessionStorage.setItem(STEP_STORAGE_KEY, palmReadingConfig.steps[stepIndex].id);

                    // --- FIX for Enter key submission ---
                    // Add new listener if we are on the emailVerification step
                    const step = palmReadingConfig.steps[stepIndex];
                    if (step.id === 'emailVerification') {
                        currentOtpKeyListener = (event) => {
                            const nextBtn = document.getElementById('next-btn');
                            if (event.key === 'Enter' && nextBtn && !nextBtn.disabled) {
                                event.preventDefault();
                                nextBtn.click();
                            }
                        };
                        document.addEventListener('keydown', currentOtpKeyListener);
                        log('OTP Enter key listener added.');
                    }
                    // --- END FIX ---
                    if (step.id !== 'result' && step.id !== 'resultLoading') {
                        const modal = document.getElementById('sm-modal') || document.querySelector('.sm-modal');
                        if (modal) {
                            modal.remove();
                        }
                    }
                }
            } catch (e) {
                logError('Failed to store step state or manage OTP listener', e);
            }
            return result;
        };
        window.renderStep._smWrapped = true;
    }


    function restoreStepFromSession() {
        if (!window.appContent) {
            return;
        }

        const storedReadingLoaded = sessionStorage.getItem('sm_reading_loaded');
        const stepId = sessionStorage.getItem(STEP_STORAGE_KEY);
        if (storedReadingLoaded === 'true') {
            if (stepId && stepId !== 'result' && stepId !== 'resultLoading') {
                sessionStorage.removeItem('sm_reading_loaded');
            } else {
                return;
            }
        }

        const params = new URLSearchParams(window.location.search);
        if (params.get('sm_magic')) {
            return;
        }

        if (!stepId) {
            return;
        }

        if (jumpToStepWhenReady(stepId)) {
            enforceStepAfterInit(stepId);
        }
    }

    // Logging helper
    function log(message, data = null) {
        console.log(`[SM API] ${message}`, data || '');
    }

    // Error helper
    function logError(message, error = null) {
        console.error(`[SM API ERROR] ${message}`, error || '');
    }

    function normalizeGender(identity) {
        const value = (identity || '').toLowerCase();
        if (value === 'woman' || value === 'female' || value === 'f') return 'female';
        if (value === 'man' || value === 'male' || value === 'm') return 'male';
        if (value === 'prefer-not' || value === 'prefer_not' || value === 'prefer not to say') return 'prefer_not_to_say';
        return 'prefer_not_to_say';
    }

    function mapAgeToRange(ageInput) {
        const age = parseInt(ageInput, 10);
        if (isNaN(age) || age < 18) return '';
        if (age <= 25) return 'age_18_25';
        if (age <= 35) return 'age_26_35';
        if (age <= 50) return 'age_36_50';
        if (age <= 65) return 'age_51_65';
        return 'age_65_plus';
    }

    function getDemographics() {
        const cachedAge = (apiState.demographics && apiState.demographics.ageRange) || '';
        const cachedGender = (apiState.demographics && apiState.demographics.gender) || '';
        const derivedAgeRange = mapAgeToRange(appState.userData.age || appState.userData.ageRange);
        const ageRange = (derivedAgeRange || appState.userData.ageRange || cachedAge || '').trim();
        const gender = normalizeGender(appState.userData.identity) || cachedGender || 'prefer_not_to_say';
        return {
            ageRange,
            gender
        };
    }

    function resolveQuestionKey(question, fallback) {
        if (!question) return fallback;
        return question.id || question.question_id || fallback;
    }

    let isRefreshingNonce = false;

    async function refreshNonce() {
        if (!smData.nonceRefreshUrl || isRefreshingNonce) {
            return null;
        }

        isRefreshingNonce = true;

        try {
            const response = await fetch(smData.nonceRefreshUrl, {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                    'X-SM-Nonce': smData.nonce
                },
                credentials: 'same-origin'
            });

            const data = await response.json().catch(() => null);

            if (response.ok && data && data.data && data.data.nonce) {
                smData.nonce = data.data.nonce;
                log('Nonce refreshed successfully');
                return smData.nonce;
            }

            logError('Nonce refresh failed', data);
            return null;
        } catch (error) {
            logError('Nonce refresh request failed', error);
            return null;
        } finally {
            isRefreshingNonce = false;
        }
    }

    // API Request Helper
    async function makeApiRequest(endpoint, method = 'POST', body = null) {
        const url = smData.apiUrl + endpoint;

        const options = {
            method: method,
            headers: {
                'Content-Type': 'application/json',
                'X-SM-Nonce': smData.nonce  // Use custom header to avoid WP core cookie auth
            },
            credentials: 'same-origin'
        };

        if (body && method !== 'GET') {
            options.body = JSON.stringify(body);
        }

        const performRequest = async () => {
            log(`${method} ${endpoint}`, body);
            console.log('[SM API] Request headers:', {
                'X-SM-Nonce': smData.nonce,
                'Content-Type': 'application/json'
            });

            const response = await fetch(url, options);
            let data = null;
            try {
                data = await response.json();
            } catch (e) {
                data = null;
            }

            if (!response.ok) {
                const err = new Error((data && data.message) || 'API request failed');
                err.data = data;
                err.status = response.status;
                throw err;
            }

            log(`‚úì ${endpoint} success`, data);
            return data;
        };

        try {
            return await performRequest();
        } catch (error) {
            const status = error && error.status ? error.status : null;
            if ((status === 401 || status === 403) && await refreshNonce()) {
                options.headers['X-SM-Nonce'] = smData.nonce;
                log('Retrying request after nonce refresh');
                return await performRequest();
            }
            logError(`‚úó ${endpoint} failed`, error);
            throw error;
        }
    }

    // Toast Notification Helper
    function showToast(message, type = 'error', duration = 3500) {
        const toast = document.getElementById('toast');
        if (!toast) {
            alert(message);
            return;
        }

        toast.textContent = message;
        toast.classList.remove('toast-offerings');
        toast.className = `toast ${type} show`;

        setTimeout(() => {
            toast.classList.remove('show');
        }, duration);
    }

    function showAuthErrorToast() {
        try {
            const params = new URLSearchParams(window.location.search);
            const code = params.get('sm_auth_error');
            if (!code) {
                return;
            }

            let message = 'We could not log you in. Please try again.';
            if (code === 'missing_profile') {
                message = 'Your account is missing required details (name, email, or date of birth). Please update your account and try again.';
            }

            showToast(message, 'error', 5000);

            params.delete('sm_auth_error');
            params.delete('sm_auth_missing');
            const newQuery = params.toString();
            const newUrl = `${window.location.pathname}${newQuery ? `?${newQuery}` : ''}${window.location.hash || ''}`;
            window.history.replaceState({}, document.title, newUrl);
        } catch (error) {
            logError('Failed to show auth error toast', error);
        }
    }

    function extractRedirectUrl(error) {
        if (!error || !error.data) return null;
        if (error.data.redirect_to) return error.data.redirect_to;
        if (error.data.data && error.data.data.redirect_to) return error.data.data.redirect_to;
        return null;
    }

    function markReportUrl() {
        try {
            const url = new URL(window.location.href);
            url.searchParams.set('sm_report', '1');

            // CRITICAL: Add lead_id to URL for reliable refresh detection
            if (apiState.leadId) {
                url.searchParams.set('lead_id', apiState.leadId);
            }

            window.history.pushState({}, '', url.toString());
            log('‚úÖ Marked report URL:', url.toString());
        } catch (error) {
            logError('Failed to mark report URL', error);
        }
    }

    // Render an existing reading and jump to the result step
    function renderExistingReading(readingHtml, readingId, leadId) {
        if (!readingHtml) return false;

        // Check if reading is already rendered in DOM (prevent duplicate renders)
        const existingReport = document.getElementById('palm-reading-result');
        if (existingReport && existingReport.querySelector('[data-reading-id]')) {
            log('Reading already rendered in DOM, skipping duplicate render');
            // If already rendered, ensure the event is dispatched if it hasn't been yet
            if (!teaserEventDispatched) {
                const teaserEvent = new CustomEvent('sm:teaser_loaded');
                document.dispatchEvent(teaserEvent);
                teaserEventDispatched = true;
                log('Dispatched sm:teaser_loaded (deduplicated via renderExistingReading).');
            }
            return true;
        }

        // Persist lead id so downstream calls use the same record
        if (leadId) {
            apiState.leadId = leadId;
            appState.leadId = leadId;
            sessionStorage.setItem('sm_reading_lead_id', leadId);
        }

        const lastStepIndex = palmReadingConfig.steps.length - 1;
        appState.currentStep = lastStepIndex;

        // Extract body content if HTML is a full document (with DOCTYPE, html, head, body tags)
        let htmlToInject = readingHtml;
        const bodyMatch = readingHtml.match(/<body[^>]*>([\s\S]*)<\/body>/i);
        if (bodyMatch && bodyMatch[1]) {
            htmlToInject = bodyMatch[1];
            log('Extracted body content from full HTML document');
        }

        appContent.innerHTML = htmlToInject;

        if (backBtn) backBtn.style.display = 'none';
        if (nextBtn) nextBtn.style.display = 'none';

        if (typeof updateProgressBar === 'function') {
            updateProgressBar();
        }

        // CRITICAL: Verify reading container exists before marking as loaded
        // This prevents infinite loops when reading HTML is invalid
        const verifyContainer = document.getElementById('palm-reading-result');
        if (!verifyContainer) {
            logError('Reading HTML injected but #palm-reading-result not found - aborting render');
            return false;
        }

        // Only dispatch the teaser event if it hasn't been dispatched before
        if (!teaserEventDispatched) {
            const teaserEvent = new CustomEvent('sm:teaser_loaded');
            document.dispatchEvent(teaserEvent);
            teaserEventDispatched = true;
            log('Dispatched sm:teaser_loaded (first time via renderExistingReading).');
        }

        // ONLY mark reading as loaded AFTER confirming container exists (CRITICAL for page refresh)
        sessionStorage.setItem('sm_reading_loaded', 'true');
        sessionStorage.setItem('sm_flow_step_id', 'result');

        // Cache reading id and lead id if provided
        if (readingId) {
            sessionStorage.setItem('sm_existing_reading_id', readingId);
        }
        if (leadId) {
            sessionStorage.setItem('sm_reading_lead_id', leadId);
        }

        log('üî• EXISTING READING RENDERED - About to mark URL with lead_id:', leadId);
        markReportUrl();
        log('üî• URL marked. Current URL:', window.location.href);

        return true;
    }

    // ========================================
    // API INTEGRATION FUNCTIONS
    // ========================================

    /**
     * Create Lead
     * Called after lead capture form is submitted
     */
    async function createLead(name, email, identity, gdprConsent) {
        log('Creating lead...', { name, email, identity });

        try {
            const response = await makeApiRequest('lead/create', 'POST', {
                name: name,
                email: email,
                identity: identity,
                gdpr: gdprConsent,
                age: appState.userData.age || '',
                age_range: appState.userData.ageRange || ''
            });

            if (response.success && response.data) {
                // Existing reading path (no new credits used)
                if (response.data.existing_reading && response.data.reading_html) {
                    log('‚úì Existing reading returned for email, skipping OTP/generation', { email });

                    // Update flow state to result page
                    await updateFlowState({
                        step_id: 'result',
                        status: 'reading_ready',
                        lead_id: response.data.lead_id,
                        reading_id: response.data.reading_id,
                        email: email
                    });

                    renderExistingReading(response.data.reading_html, response.data.reading_id, response.data.lead_id || null);
                    return { existingReading: true };
                }

                if (response.data.lead_id) {
                    apiState.leadId = response.data.lead_id;
                    log('‚úì Lead created', { leadId: apiState.leadId });
                    persistLeadCache({
                        leadId: apiState.leadId,
                        email: email,
                        name: name,
                        identity: identity,
                        age: appState.userData.age || '',
                        ageRange: appState.userData.ageRange || '',
                        gdprConsent: gdprConsent
                    });

                    // Update flow state - lead created, ready for OTP
                    await updateFlowState({
                        step_id: 'emailVerification',
                        status: 'otp_pending',
                        lead_id: apiState.leadId,
                        email: email
                    });

                    return { leadCreated: true };
                }

                throw new Error('Invalid response from lead creation');
            } else {
                throw new Error('Invalid response from lead creation');
            }

        } catch (error) {
            logError('Lead creation failed', error);

            const redirectUrl = extractRedirectUrl(error);
            if (error && error.data && error.data.error_code === 'credits_exhausted' && redirectUrl) {
                window.location.href = redirectUrl;
                return false;
            }

            showToast(error.message || 'Failed to create your profile. Please try again.', 'error');
            return false;
        }
    }

    /**
     * Send OTP
     * Called after email loading animation
     */
    async function sendOtp(email) {
        if (apiState.otpSent) {
            log('OTP already sent, skipping...');
            return true;
        }

        log('Sending OTP...', { email });

        try {
            const response = await makeApiRequest('otp/send', 'POST', {
                lead_id: apiState.leadId,
                email: email
            });

            if (response.success) {
                apiState.otpSent = true;
                log('‚úì OTP sent successfully');
                return true;
            } else {
                throw new Error(response.message || 'Failed to send OTP');
            }

        } catch (error) {
            logError('OTP send failed', error);
            showToast(error.message || 'Failed to send verification code. Please try again.');
            return false;
        }
    }

    /**
     * Verify OTP
     * Called when user submits 4-digit code
     */
    async function verifyOtp(otpCode) {
        log('Verifying OTP...', { code: otpCode });

        try {
            const response = await makeApiRequest('otp/verify', 'POST', {
                lead_id: apiState.leadId,
                otp: otpCode
            });

            if (response.success) {
                apiState.otpVerified = true;
                appState.userData.emailVerified = true;
                if (appState.userData.email) {
                    sessionStorage.setItem('sm_email', appState.userData.email);
                }
                log('‚úì OTP verified successfully');

                // Update flow state - OTP verified, ready for palm photo
                await updateFlowState({
                    step_id: 'palmPhoto',
                    status: 'otp_verified'
                });

                // Trigger MailerLite sync (non-blocking)
                syncToMailerLite().catch(err => {
                    logError('MailerLite sync failed (non-blocking)', err);
                });

                return true;
            } else {
                throw new Error(response.message || 'Invalid verification code');
            }

        } catch (error) {
            logError('OTP verification failed', error);
            showToast(error.message || 'Invalid code. Please try again.');
            return false;
        }
    }

    /**
     * Verify OTP via magic link token (auto-validation from email click)
     */
    async function verifyOtpWithMagicLink(token, leadFromUrl) {
        if (magicLinkHandled) {
            return;
        }

        const leadId = leadFromUrl || apiState.leadId;
        if (!token || !leadId) {
            return;
        }

        log('Attempting magic link verification...', { leadId });
        showMagicOverlay();
        if (typeof showToast === 'function') {
            showToast('Verifying your magic link. Please wait...', 'info');
        }
        const verifyStart = performance.now();

        try {
            const response = await makeApiRequest('flow/magic/verify', 'POST', {
                lead_id: leadId,
                token: token
            });
            const verifyDurationMs = Math.round(performance.now() - verifyStart);
            log('Magic link verification completed', { durationMs: verifyDurationMs });

            if (response.success) {
                const leadData = response.data && response.data.lead ? response.data.lead : null;
                const reading = response.data && response.data.reading ? response.data.reading : null;
                const flowState = response.data && response.data.flow ? response.data.flow : null;
                apiState.leadId = (leadData && leadData.id) || leadId;
                apiState.otpVerified = true;
                apiState.otpSent = true;
                appState.userData.emailVerified = true;
                magicLinkHandled = true;

                // Prefill lead data from backend snapshot or cached data
                const cached = readLeadCache();
                const source = leadData || (cached && cached.leadId === leadId ? cached : null);

                if (source) {
                    appState.userData.email = source.email || appState.userData.email;
                    appState.userData.name = source.name || appState.userData.name;
                    appState.userData.identity = source.identity || appState.userData.identity;
                    appState.userData.age = source.age || appState.userData.age;
                    appState.userData.ageRange = source.age_range || source.ageRange || appState.userData.ageRange;
                    appState.userData.gdprConsent = source.gdpr ?? source.gdprConsent ?? appState.userData.gdprConsent;

                    persistLeadCache({
                        leadId: apiState.leadId,
                        email: appState.userData.email,
                        name: appState.userData.name,
                        identity: appState.userData.identity,
                        age: appState.userData.age,
                        ageRange: appState.userData.ageRange,
                        gdprConsent: appState.userData.gdprConsent
                    });
                }
                if (appState.userData.email) {
                    sessionStorage.setItem('sm_email', appState.userData.email);
                }

                log('‚úì Magic link verified successfully');
                showToast('Email verified automatically. Continue to the next step.', 'success');

                // If reading already exists, render it immediately and skip the flow.
                if (reading && reading.exists && reading.reading_html) {
                    log('Existing reading found via magic link payload, rendering immediately', { readingId: reading.reading_id });
                    if (window.appContent) {
                        window.appContent.innerHTML = reading.reading_html;
                    } else {
                        log('Cannot render reading HTML; #app-content not available.');
                    }

                    // CRITICAL: Verify reading container exists before marking as loaded
                    const verifyContainer = document.getElementById('palm-reading-result');
                    if (!verifyContainer) {
                        logError('Magic link: Reading HTML injected but #palm-reading-result not found - skipping state save');
                        // Don't set reading loaded flag if container missing
                        return false;
                    }

                    sessionStorage.setItem('sm_reading_lead_id', apiState.leadId);
                    sessionStorage.setItem('sm_reading_token', token);
                    sessionStorage.setItem('sm_reading_loaded', 'true');
                    markReportUrl();

                    // Hide navigation and update progress to last step
                    if (window.backBtn) backBtn.style.display = 'none';
                    if (window.nextBtn) nextBtn.style.display = 'none';
                    const lastStepIndex = palmReadingConfig.steps.length - 1;
                    appState.currentStep = lastStepIndex;
                    if (typeof updateProgressBar === 'function') {
                        updateProgressBar();
                    }

                    // Fire teaser loaded event
                    if (!teaserEventDispatched) {
                        const teaserEvent = new CustomEvent('sm:teaser_loaded');
                        document.dispatchEvent(teaserEvent);
                        teaserEventDispatched = true;
                        log('Dispatched sm:teaser_loaded (magic link).');
                    }
                    hideMagicOverlay();
                    return true;
                }

                if (flowState && flowState.step_id && jumpToStepWhenReady(flowState.step_id)) {
                    enforceStepAfterInit(flowState.step_id);
                    setTimeout(hideMagicOverlay, 300);
                    return true;
                }

                if (jumpToStepWhenReady('palmPhoto')) {
                    enforceStepAfterInit('palmPhoto');
                    setTimeout(hideMagicOverlay, 300);
                    return true;
                }

                if (jumpToStepWhenReady('emailVerification')) {
                    setTimeout(() => {
                        if (typeof window.goToNextStep === 'function') {
                            window.goToNextStep();
                        }
                    }, 150);
                    setTimeout(hideMagicOverlay, 300);
                }

                return true;
            } else {
                throw new Error(response.message || 'Magic link verification failed');
            }
        } catch (error) {
            magicLinkHandled = true; // Avoid repeated failing retries on load
            logError('Magic link verification failed', error);
            resetFlowState(true);
            showToast((error.message || 'Link invalid or expired. Please enter the code manually.') + ' Starting over...', 'error');
            hideMagicOverlay();
            return false;
        }
    }

    /**
     * Sync to MailerLite
     * Called after OTP verification (non-blocking)
     */
    async function syncToMailerLite() {
        log('Syncing to MailerLite...');

        try {
            const response = await makeApiRequest('mailerlite/sync', 'POST', {
                lead_id: apiState.leadId
            });

            if (response.success) {
                log('‚úì MailerLite sync successful');
            } else {
                // Don't throw - this is non-blocking
                logError('MailerLite sync returned error (non-blocking)', response.message);
            }

        } catch (error) {
            // Don't throw - this is non-blocking
            logError('MailerLite sync failed (non-blocking)', error);
        }
    }

    /**
     * Upload Palm Image
     * Called when user captures or uploads palm photo
     */
    async function uploadPalmImage(imageDataUrl) {
        log('Uploading palm image...');

        try {
            const response = await makeApiRequest('image/upload', 'POST', {
                lead_id: apiState.leadId,
                image: imageDataUrl
            });

            if (response.success && response.data && response.data.image_url) {
                apiState.imageUploaded = true;
                log('‚úì Palm image uploaded', { url: response.data.image_url });

                // Update flow state - image uploaded, ready for quiz
                await updateFlowState({
                    step_id: 'quiz',
                    status: 'otp_verified'
                });

                return response.data.image_url;
            } else {
                throw new Error('Invalid response from image upload');
            }

        } catch (error) {
            logError('Image upload failed', error);
            showToast(error.message || 'Failed to upload palm image. Please try again.');
            return null;
        }
    }

    /**
     * Fetch dynamic quiz questions based on demographics
     * Called before entering the quiz flow
     */
    async function fetchDynamicQuestions(ageRange, gender) {
        const params = new URLSearchParams();
        if (apiState.leadId) {
            params.append('lead_id', apiState.leadId);
        }
        params.append('age_range', ageRange);
        params.append('gender', gender);

        try {
            const response = await makeApiRequest(`quiz/questions?${params.toString()}`, 'GET');

            const questions = response.questions || (response.data && response.data.questions);

            if (response.success && Array.isArray(questions)) {
                apiState.dynamicQuestions = questions;
                apiState.demographics = { ageRange, gender };
                appState.dynamicQuestions = questions;
                log('‚úì Dynamic questions fetched', { count: questions.length, ageRange, gender });
                return questions;
            }

            throw new Error('Invalid response from questions endpoint');
        } catch (error) {
            logError('Fetch dynamic questions failed', error);
            showToast(error.message || 'Failed to load your personalized questions. Please try again.');
            return null;
        }
    }

    /**
     * Save Quiz Responses
     * Called after all quiz questions are answered
     */
    async function saveQuiz(quizResponses) {
        log('Saving quiz responses...', quizResponses);

        const hasDynamicQuestions = Array.isArray(appState.dynamicQuestions) && appState.dynamicQuestions.length > 0;
        let payload = null;

        if (hasDynamicQuestions) {
            const demographics = apiState.demographics.ageRange && apiState.demographics.gender
                ? apiState.demographics
                : getDemographics();

            if (!demographics.ageRange || !demographics.gender) {
                showToast('Please select your age range and how you identify to continue.');
                return false;
            }

            const normalizedQuestions = appState.dynamicQuestions.slice(0, 5);
            if (normalizedQuestions.length !== 5) {
                logError('Dynamic question count invalid', { count: normalizedQuestions.length });
                showToast('We had trouble loading your personalized questions. Please go back and try again.');
                return false;
            }

            // DEBUG: Log all question IDs and available response keys
            log('[DEBUG] Dynamic questions:', normalizedQuestions.map((q, i) => ({
                index: i,
                id: q.id,
                question_id: q.question_id,
                type: q.type
            })));
            log('[DEBUG] Available quiz response keys:', Object.keys(quizResponses));

            const questionsPayload = normalizedQuestions.map((question, idx) => {
                const questionId = question.id || question.question_id || `quiz_${idx + 1}`;
                const questionType = question.type || question.question_type || 'multiple_choice';
                const responseKey = resolveQuestionKey(question, questionId);

                // DEBUG: Log the key resolution process
                log(`[DEBUG] Question ${idx + 1} key resolution:`, {
                    question_id_field: question.id,
                    question_question_id_field: question.question_id,
                    resolved_key: responseKey,
                    has_response: typeof quizResponses[responseKey] !== 'undefined'
                });

                const rawAnswer = typeof quizResponses[responseKey] !== 'undefined'
                    ? quizResponses[responseKey]
                    : quizResponses[questionId] || quizResponses[`quiz${idx + 1}`];

                // DEBUG: Log raw answer for this question
                log(`[DEBUG] Question ${idx + 1} raw answer:`, {
                    responseKey,
                    rawAnswer,
                    rawAnswerType: typeof rawAnswer,
                    isUndefined: typeof rawAnswer === 'undefined',
                    isNull: rawAnswer === null,
                    isEmpty: rawAnswer === ''
                });

                const normalizedOptions = Array.isArray(question.options)
                    ? question.options.map(opt => {
                        if (typeof opt === 'string') return opt;
                        return opt.label || opt.value || opt.id || '';
                    }).filter(Boolean)
                    : [];

                let answerValue = rawAnswer;

                if ((questionType === 'multi_select' || questionType === 'multiple_choice_multi') && !Array.isArray(answerValue)) {
                    answerValue = answerValue ? [String(answerValue)] : [];
                } else if (Array.isArray(answerValue)) {
                    answerValue = answerValue.map(val => val.toString());
                } else if (questionType === 'rating') {
                    answerValue = typeof answerValue === 'number' ? answerValue : Number(answerValue || 0);
                } else {
                    answerValue = typeof answerValue === 'undefined' || answerValue === null ? '' : answerValue.toString();
                }

                // Validate answer is not empty
                const isEmptyAnswer = (Array.isArray(answerValue) && answerValue.length === 0) ||
                                    (!Array.isArray(answerValue) && (answerValue === '' || answerValue === 0 && questionType !== 'rating'));

                if (isEmptyAnswer) {
                    logError(`Question ${idx + 1} has empty answer`, {
                        questionId: responseKey,
                        questionText: question.question || question.question_text,
                        answerValue,
                        availableKeys: Object.keys(quizResponses)
                    });
                }

                let category = question.category || '';
                if (!category && Array.isArray(question.category_map) && Array.isArray(question.options)) {
                    const optionLabels = question.options.map(opt => (typeof opt === 'string' ? opt : (opt.label || opt.value || opt.id || '')));
                    const answerIndex = optionLabels.findIndex(label => label === answerValue);
                    if (answerIndex >= 0 && question.category_map[answerIndex]) {
                        category = question.category_map[answerIndex];
                    }
                }

                return {
                    position: question.position || idx + 1,
                    question_id: questionId,
                    question_text: question.question || question.question_text || '',
                    question_type: questionType,
                    category: category,
                    options: normalizedOptions,
                    answer: answerValue
                };
            });

            payload = {
                demographics: {
                    age_range: demographics.ageRange,
                    gender: demographics.gender
                },
                questions: questionsPayload,
                selected_at: new Date().toISOString().slice(0, 19).replace('T', ' ')
            };
        } else {
            // Transform frontend quiz keys (quiz1, quiz2, etc.) to backend keys
            const transformedAnswers = {
                energy: quizResponses.quiz1,        // Question 1: How would you describe your energy lately?
                focus: quizResponses.quiz2,         // Question 2: What is your biggest focus right now?
                element: quizResponses.quiz3,       // Question 3: Which element resonates with you most?
                intentions: quizResponses.quiz4,    // Question 4: What do you seek guidance on? (multi-select)
                future_goals: quizResponses.quiz5   // Question 5: Share an intention or wish for your future (text)
            };

            log('Transformed quiz answers:', transformedAnswers);
            payload = transformedAnswers;
        }

        try {
            const response = await makeApiRequest('quiz/save', 'POST', {
                lead_id: apiState.leadId,
                answers: payload
            });

            if (response.success) {
                apiState.quizSaved = true;
                log('‚úì Quiz responses saved');

                // Update flow state - quiz saved, ready for reading generation
                await updateFlowState({
                    step_id: 'resultLoading',
                    status: 'quiz_completed'
                });

                return true;
            } else {
                throw new Error('Invalid response from quiz save');
            }

        } catch (error) {
            logError('Quiz save failed', error);
            showToast(error.message || 'Failed to save your responses. Please try again.');
            return false;
        }
    }

    function getPreferredReadingType() {
        if (window.smData && window.smData.isLoggedIn && window.smData.accountIntegrationEnabled) {
            return 'palm_full';
        }
        return 'palm_teaser';
    }

    /**
     * Generate AI Reading
     * Called during result loading animation
     */
    async function generateReading() {
        log('Generating AI reading...');
        const usePaidFlow = !!(window.smData && window.smData.isLoggedIn && window.smData.accountIntegrationEnabled);
        const endpoint = usePaidFlow ? 'reading/generate-paid' : 'reading/generate';

        try {
            if (!apiState.imageUploaded && appState.userData && appState.userData.palmImage) {
                log('Palm image not uploaded yet. Uploading before reading generation...');
                const imageUrl = await uploadPalmImage(appState.userData.palmImage);
                if (!imageUrl) {
                    throw new Error('Please upload your palm image first.');
                }
            }

            const response = await makeApiRequest(endpoint, 'POST', {
                lead_id: apiState.leadId
            });

            if (response.success && response.data && response.data.reading_html) {
                apiState.readingGenerated = true;
                if (window.clearLoadingTimers) {
                    window.clearLoadingTimers();
                }
                log('‚úì AI reading generated');
                if (response.data.reading_id) {
                    sessionStorage.setItem('sm_existing_reading_id', response.data.reading_id);
                }

                // Update flow state - reading generated successfully
                await updateFlowState({
                    step_id: 'result',
                    status: 'reading_ready',
                    reading_id: response.data.reading_id
                });

                // Cache reading metadata (but DON'T set sm_reading_loaded yet)
                // The rendering function will set it AFTER validating the container exists
                sessionStorage.setItem('sm_reading_lead_id', apiState.leadId);
                sessionStorage.setItem('sm_existing_reading_id', response.data.reading_id);

                log('üî• READING GENERATED - About to mark URL with lead_id:', apiState.leadId);
                markReportUrl();
                log('üî• URL marked. Current URL:', window.location.href);
                return response.data.reading_html;
            } else {
                throw new Error('Invalid response from reading generation');
            }

        } catch (error) {
            logError('Reading generation failed', error);
            const redirectUrl = extractRedirectUrl(error);
            const errorCode = error && error.data ? error.data.error_code : null;
            if (redirectUrl && (errorCode === 'credits_exhausted' || errorCode === 'reading_exists')) {
                window.location.href = redirectUrl;
                return null;
            }
            if (window.showReadingErrorState) {
                window.showReadingErrorState(error.message || 'Failed to generate your reading. Please try again.');
            }
            showToast(error.message || 'We could not generate your reading. Please try again or contact support.');
            return null;
        }
    }

    // ========================================
    // INTEGRATION HOOKS
    // ========================================

    /**
     * Hook into the existing goToNextStep function
     * This intercepts navigation to trigger API calls at the right times
     */
    const originalGoToNextStep = window.goToNextStep;

    window.goToNextStep = async function () {
        if (apiState.processingRequest) {
            log('Request already in progress. Ignoring additional click.');
            return;
        }

        const currentStep = palmReadingConfig.steps[appState.currentStep];
        const currentStepId = currentStep.id;
        const nextBtn = document.getElementById('next-btn');
        let toggledLoading = false;

        const startLoading = () => {
            if (nextBtn && typeof setButtonLoading === 'function' && !toggledLoading) {
                setButtonLoading(nextBtn, true);
                toggledLoading = true;
            }
        };

        const stopLoading = () => {
            if (toggledLoading && nextBtn && typeof setButtonLoading === 'function') {
                setButtonLoading(nextBtn, false);
            }
        };

        log(`Intercepted goToNextStep - Current step: ${currentStepId}`);

        // OPTIMISTIC UI: Removed blocking check - navigate first, handle API calls in background
        // This prevents the "frozen" feeling on mobile when API calls are slow

        try {
            // Step 2: Lead Capture ‚Üí Create lead AND Send OTP immediately
            if (currentStepId === 'leadCapture') {
                apiState.processingRequest = true;
                startLoading();

                // Create lead first
                const leadResult = await createLead(
                    appState.userData.name,
                    appState.userData.email,
                    appState.userData.identity,
                    appState.userData.gdprConsent
                );

                if (!leadResult) {
                    return; // Block navigation if lead creation failed
                }

                if (leadResult.existingReading) {
                    stopLoading();
                    apiState.processingRequest = false;
                    return; // We already rendered the reading; halt normal flow
                }

                if (!leadResult.leadCreated) {
                    return; // Block navigation if lead creation failed
                }

                // Send OTP immediately after lead creation
                const otpSuccess = await sendOtp(appState.userData.email);
                if (!otpSuccess) {
                    return; // Block navigation if OTP send failed
                }
            }

            // Step 3: Email Loading ‚Üí Just animation, OTP already sent
            // No API call needed here, OTP was sent in previous step

            // Step 4: Email Verification ‚Üí Verify OTP before proceeding
            if (currentStepId === 'emailVerification' && !apiState.otpVerified) {
                apiState.processingRequest = true;
                startLoading();

                // Get OTP code from inputs
                const codeInputs = document.querySelectorAll('.code-input');
                let otpCode = '';
                codeInputs.forEach(input => {
                    otpCode += input.value;
                });

                if (otpCode.length !== 4) {
                    showToast('Please enter all 4 digits');
                    return; // Block navigation
                }

                const success = await verifyOtp(otpCode);
                if (!success) {
                    return; // Block navigation if OTP verification failed
                }
            }

            // Step 5: Palm Photo ‚Üí Validate image exists, then navigate immediately
            // Upload and question fetching happen in background (non-blocking)
            if (currentStepId === 'palmPhoto') {
                log('Checking palm image...', {
                    hasPalmImage: !!appState.userData.palmImage,
                    imageUploaded: apiState.imageUploaded,
                    imageLength: appState.userData.palmImage ? appState.userData.palmImage.length : 0
                });

                // Validate that an image was captured
                if (!appState.userData.palmImage) {
                    showToast('Please capture or upload your palm photo first');
                    return; // Block navigation if no image
                }

                // NOTE: Image upload and question fetching moved to background
                // We navigate immediately to prevent mobile "frozen" feeling
                // Background tasks continue after navigation in handleBackgroundPalmPhotoTasks()
            }

            // Step 10: Last Quiz Question ‚Üí Save quiz before going to result loading
            const quizStepIds = palmReadingConfig.steps.filter(s => s.type === 'quizQuestion').map(s => s.id);
            const lastQuizStepId = quizStepIds[quizStepIds.length - 1];

            if (currentStepId === lastQuizStepId && !apiState.quizSaved) {
                apiState.processingRequest = true;
                startLoading();

                const success = await saveQuiz(appState.quizResponses);
                if (!success) {
                    return; // Block navigation if quiz save failed
                }
            }

            // Step 11: Result Loading ‚Üí Generate AI reading before showing result
            if (currentStepId === 'resultLoading') {
                if (!apiState.readingGenerated) {
                    apiState.processingRequest = true;
                    startLoading();

                    const readingHtml = await generateReading();

                    if (!readingHtml) {
                        return; // Block navigation if reading generation failed
                    }

                    // Replace the fake reading with the real one
                    // Override the generateReading function in palmReadingConfig
                    palmReadingConfig.result.generateReading = function () {
                        return readingHtml;
                    };
                }
            }

            // Call original navigation function
            originalGoToNextStep();

            // PHASE 1.3: Handle background tasks after navigation (non-blocking)
            // This prevents the "frozen" feeling on mobile
            if (currentStepId === 'palmPhoto') {
                // Upload image and fetch questions in background
                handleBackgroundPalmPhotoTasks().catch(err => {
                    logError('Background palm photo tasks failed (non-blocking)', err);
                    showToast('Some data may not have saved. Your reading will use default questions.', 'warning', 3000);
                });
            }
        } catch (error) {
            logError('Navigation blocked due to error', error);
            showToast(error.message || 'Something went wrong. Please try again.', 'error', 4000);
        } finally {
            apiState.processingRequest = false;
            stopLoading();
        }
    };

    /**
     * Handle palm photo background tasks (non-blocking)
     * Uploads image and fetches personalized questions after user has navigated to quiz
     */
    async function handleBackgroundPalmPhotoTasks() {
        try {
            // Upload image if not already uploaded
            if (!apiState.imageUploaded && appState.userData.palmImage) {
                log('Background: Uploading palm image...');
                const imageUrl = await uploadPalmImage(appState.userData.palmImage);
                if (imageUrl) {
                    log('Background: Palm image uploaded successfully');
                } else {
                    logError('Background: Palm image upload failed (non-blocking)');
                }
            }

            // Fetch personalized questions if not already fetched
            if (!apiState.dynamicQuestions.length) {
                const demographics = getDemographics();
                log('Background: Fetching dynamic questions...', demographics);

                // Fallback to safe defaults if demographics missing
                if (!demographics.ageRange) {
                    demographics.ageRange = 'age_26_35';
                    appState.userData.ageRange = demographics.ageRange;
                }
                if (!demographics.gender) {
                    demographics.gender = 'prefer_not_to_say';
                    appState.userData.identity = 'prefer-not';
                }

                const questions = await fetchDynamicQuestions(demographics.ageRange, demographics.gender);
                if (questions && questions.length > 0) {
                    log('Background: Dynamic questions fetched successfully');
                    // Reset quiz answers when new questions load
                    appState.quizResponses = {};
                    // Note: UI will continue using static questions if user already started answering
                } else {
                    logError('Background: Dynamic questions fetch failed (non-blocking)');
                }
            }
        } catch (error) {
            logError('Background palm photo tasks error (non-blocking)', error);
            // Don't throw - this is non-blocking
        }
    }

    /**
     * Start-new flow for logged-in users (skip email/OTP and jump to camera).
     *
     * @returns {Promise<boolean>} True if handled, false otherwise.
     */
    async function bootstrapStartNewFlow() {
        const params = new URLSearchParams(window.location.search);
        if (params.get('start_new') !== '1') {
            return false;
        }

        log('Start-new flag detected - loading profile details.');

        try {
            const response = await makeApiRequest('lead/current?start_new=1', 'GET');
            if (!response.success || !response.data || !response.data.lead) {
                throw new Error(response.message || 'Unable to load your profile.');
            }

            const lead = response.data.lead;
            apiState.leadId = lead.id || null;
            apiState.otpVerified = true;
            apiState.otpSent = true;

            appState.userData = {
                name: lead.name || '',
                email: lead.email || '',
                identity: lead.identity || '',
                age: lead.age || '',
                ageRange: lead.age_range || '',
                gdprConsent: !!lead.gdpr,
                palmImage: null,
                emailVerified: true
            };

            if (lead.email) {
                sessionStorage.setItem('sm_email', lead.email);
            }

            const removeStartNewParam = () => {
                try {
                    const newUrl = new URL(window.location.href);
                    newUrl.searchParams.delete('start_new');
                    window.history.replaceState({}, document.title, newUrl.toString());
                } catch (e) {
                    logError('Failed to clean start_new param', e);
                }
            };

            const missingFields = response.data.missing_fields || [];
            const gdprOnlyMissing = missingFields.length === 1 && missingFields[0] === 'gdpr';
            log('Start-new profile status', {
                profileComplete: !!response.data.profile_complete,
                missingFields,
                gdprOnlyMissing
            });
            if (response.data.profile_complete || gdprOnlyMissing) {
                const palmPhotoIndex = palmReadingConfig.steps.findIndex(s => s.id === 'palmPhoto');
                if (palmPhotoIndex >= 0) {
                    window.renderStep(palmPhotoIndex);
                    setTimeout(() => {
                        window.renderStep(palmPhotoIndex);
                    }, 250);
                }
                removeStartNewParam();
                return true;
            }

            const leadCaptureIndex = palmReadingConfig.steps.findIndex(s => s.id === 'leadCapture');
            if (leadCaptureIndex >= 0) {
                window.renderStep(leadCaptureIndex);
                setTimeout(() => {
                    window.renderStep(leadCaptureIndex);
                }, 250);
            }
            showToast('Please confirm your details to continue.', 'info');
            removeStartNewParam();
            return true;
        } catch (error) {
            logError('Start-new flow failed', error);
            showToast(error.message || 'Please enter your details to continue.', 'error');
            return false;
        }
    }

    // ========================================
    // MAGIC LINK & PAGE LOAD HANDLERS
    // ========================================

    async function handleReportRefresh() {
        const params = new URLSearchParams(window.location.search);
        if (!params.has('sm_report')) {
            return false; // Not a report refresh
        }

        log('‚≠ê REPORT REFRESH DETECTED - Forcing report load');

        // Check if reading is already rendered in DOM
        const existingReport = document.getElementById('palm-reading-result');
        if (existingReport && existingReport.querySelector('[data-reading-id]')) {
            log('Reading already visible in DOM, skipping report refresh');
            return true; // Report already handled
        }

        // Try to get lead_id from multiple sources (in order of preference)
        const urlLeadId = params.get('lead_id') || params.get('lead');
        const cachedLead = readLeadCache();
        const sessionLeadId = sessionStorage.getItem('sm_reading_lead_id');
        const leadId = urlLeadId || (cachedLead && cachedLead.leadId) || sessionLeadId;

        log('Lead ID sources:', { urlLeadId, cachedLeadId: cachedLead?.leadId, sessionLeadId, finalLeadId: leadId });

        if (!leadId) {
            logError('CRITICAL: Report refresh requested but NO lead_id found in URL, cache, or session!');
            // Don't fail - let it fall through to prevent infinite loops
            return false;
        }

        try {
            showMagicOverlay();
            log(`Fetching report for lead ID: ${leadId}`);
            const readingType = getPreferredReadingType();
            const response = await makeApiRequest(`reading/get-by-lead?lead_id=${leadId}&reading_type=${readingType}`, 'GET');

            if (response.success && response.data.exists && response.data.reading_html) {
                log('‚úÖ Successfully refetched report. Rendering...');
                renderExistingReading(response.data.reading_html, response.data.reading_id, leadId);
                hideMagicOverlay();
                return true; // Report handled
            } else {
                throw new Error('Report data not found in response.');
            }
        } catch (error) {
            logError('‚ùå Failed to reload report.', error);
            hideMagicOverlay();

            // CRITICAL: Clear reading state when report refresh fails
            // This prevents the page from trying to render a non-existent reading
            log('Clearing reading state flags since report refresh failed');
            sessionStorage.removeItem('sm_reading_loaded');
            sessionStorage.removeItem('sm_reading_lead_id');
            sessionStorage.removeItem('sm_reading_token');
            sessionStorage.removeItem('sm_existing_reading_id');

            // Return false to let normal flow continue (will start from welcome step)
            return false;
        }
    }

    async function fetchFlowState() {
        try {
            const response = await makeApiRequest('flow/state', 'GET');
            if (response && response.success && response.data) {
                return response.data;
            }
        } catch (error) {
            // Flow state is not critical - fail silently if endpoint unavailable
            log('Flow state fetch failed (non-critical), continuing without it');
        }
        return null;
    }

    /**
     * Update flow state on the backend
     * Phase C: Write-Through - Keep backend state synchronized
     */
    async function updateFlowState(updates) {
        try {
            log('Updating flow state...', updates);
            const response = await makeApiRequest('flow/state', 'POST', updates);
            if (response && response.success) {
                log('Flow state updated successfully', response.data);
                return response.data;
            } else {
                log('Flow state update failed (non-critical), continuing');
            }
        } catch (error) {
            // Flow state is not critical - fail silently if endpoint unavailable
            log('Flow state update error (non-critical), continuing');
        }
        return null;
    }

    async function handleFlowStateBootstrap() {
        const flow = await fetchFlowState();
        if (!flow || !flow.step_id) {
            return false;
        }

        if (flow.lead_id) {
            apiState.leadId = flow.lead_id;
        }

        if (flow.status === 'reading_ready' && flow.lead_id) {
            // Check if reading is already rendered in DOM before fetching
            const existingReport = document.getElementById('palm-reading-result');
            if (existingReport && existingReport.querySelector('[data-reading-id]')) {
                log('Reading already visible in DOM, skipping flow state bootstrap');
                return true;
            }

            try {
                showMagicOverlay();
                const readingType = getPreferredReadingType();
                const response = await makeApiRequest(`reading/get-by-lead?lead_id=${flow.lead_id}&reading_type=${readingType}`, 'GET');
                if (response.success && response.data.exists && response.data.reading_html) {
                    renderExistingReading(response.data.reading_html, response.data.reading_id, flow.lead_id);
                    hideMagicOverlay();
                    return true;
                }
            } catch (error) {
                logError('Flow reading reload failed', error);
            }
            hideMagicOverlay();
        }

        const blockedSteps = ['result', 'resultLoading'];
        if (flow.status !== 'reading_ready' && blockedSteps.includes(flow.step_id)) {
            return false;
        }

        if (flow.step_id && flow.step_id !== 'welcome') {
            if (jumpToStepWhenReady(flow.step_id)) {
                enforceStepAfterInit(flow.step_id);
                return true;
            }
        }

        return false;
    }


    document.addEventListener('DOMContentLoaded', () => {
        (async () => {
            try {
                const reportContainer = document.getElementById('palm-reading-result');
                if (!reportContainer) {
                    const modal = document.getElementById('sm-modal') || document.querySelector('.sm-modal');
                    if (modal) {
                        modal.remove();
                    }
                }

                showAuthErrorToast();
                wrapRenderStepForRestore();

                // --- EMERGENCY FIX: Check for infinite loop guard ---
                // Uses counter-based detection: requires 5+ rapid refreshes within 500ms to trigger
                const loopGuard = sessionStorage.getItem('sm_loop_guard');
                const currentTime = Date.now();
                if (loopGuard) {
                    try {
                        const guardData = JSON.parse(loopGuard);
                        const timeSinceLastLoad = currentTime - guardData.timestamp;

                        // If within 500ms of last load, increment counter
                        if (timeSinceLastLoad < 500) {
                            guardData.count = (guardData.count || 1) + 1;
                            guardData.timestamp = currentTime;

                            // Only block if 5+ rapid refreshes
                            if (guardData.count >= 5) {
                                logError(`‚ö†Ô∏è INFINITE LOOP DETECTED - Stopping refresh cycle (${guardData.count} rapid refreshes within 500ms)`);
                                sessionStorage.removeItem('sm_loop_guard');
                                return; // Stop all processing to break the loop
                            }

                            sessionStorage.setItem('sm_loop_guard', JSON.stringify(guardData));
                        } else {
                            // More than 500ms since last load, reset counter
                            sessionStorage.setItem('sm_loop_guard', JSON.stringify({ timestamp: currentTime, count: 1 }));
                        }
                    } catch (e) {
                        // Invalid JSON, reset guard
                        sessionStorage.setItem('sm_loop_guard', JSON.stringify({ timestamp: currentTime, count: 1 }));
                    }
                } else {
                    // First load, initialize counter
                    sessionStorage.setItem('sm_loop_guard', JSON.stringify({ timestamp: currentTime, count: 1 }));
                }
                // --- END LOOP GUARD ---

                // --- FIX for report refresh loop ---
                const reportRefreshed = await handleReportRefresh();
                if (reportRefreshed) {
                    sessionStorage.removeItem('sm_loop_guard'); // Clear guard on success
                    return; // Stop further processing if report was handled
                }
                // --- END FIX ---

                const startNewHandled = await bootstrapStartNewFlow();
                if (startNewHandled) {
                    return;
                }

                const appContentEl = document.getElementById('app-content');

            const params = new URLSearchParams(window.location.search);
            const hasMagic = params.get('sm_magic');
            const token = params.get('token');
            const lead = params.get('lead');
            const cached = readLeadCache();

            // Preload cached lead/user data to avoid missing demographics after magic link
            if (cached) {
                apiState.leadId = cached.leadId || apiState.leadId;
            }

            // --- FIX for Email Persistence on OTP page refresh ---
            // If appState.userData.email is empty but sm_email exists in sessionStorage, restore it.
            // This handles cases where the page refreshes directly on the OTP step.
            if (!appState.userData.email && sessionStorage.getItem('sm_email')) {
                appState.userData.email = sessionStorage.getItem('sm_email');
                log('Restored appState.userData.email from sessionStorage.', { email: appState.userData.email });
            }
            // --- END FIX ---

            if (hasMagic && token && lead) {
                if (!appContentEl) {
                    log('Magic link detected but app container missing; skipping auto-verify.');
                    return;
                }
                // If lead param missing but cached exists, prefer cached lead id
                const leadId = lead || (cached ? cached.leadId : null);
                verifyOtpWithMagicLink(token, leadId);
                return;
            }

            const flowHandled = await handleFlowStateBootstrap();
            if (flowHandled) {
                return;
            }
            restoreStepFromSession();
            } catch (error) {
                logError('Magic link parse failed', error);
            }
        })();
    });

    window.addEventListener('pageshow', (event) => {
        // Only handle browser back/forward navigation (persisted cache)
        // Don't run on normal page loads (those are handled by DOMContentLoaded)
        if (!event.persisted) {
            return;
        }

        const params = new URLSearchParams(window.location.search);
        const hasReportFlag = params.has('sm_report');
        if (!hasReportFlag) {
            return;
        }

        // Check if reading is already visible in DOM before bootstrapping
        const existingReport = document.getElementById('palm-reading-result');
        if (existingReport && existingReport.querySelector('[data-reading-id]')) {
            log('Reading already visible, skipping pageshow bootstrap');
            return;
        }

        log('Pageshow event with back/forward navigation, bootstrapping flow');
        handleFlowStateBootstrap();
    });

    /**
     * Hook into goToPreviousStep to reset state when going back to welcome
     */
    const originalGoToPreviousStep = window.goToPreviousStep;

    window.goToPreviousStep = function () {
        try {
            // Call original function first
            originalGoToPreviousStep();

            // If we went back to the welcome page (step 0), reset API state
            // This ensures that if user goes back to start, they can proceed forward cleanly
            if (appState.currentStep === 0) {
                log('Returned to welcome page - resetting API state for fresh start');

                // Reset all API flags (but keep processingRequest check to prevent race conditions)
                apiState.leadId = null;
                apiState.otpVerified = false;
                apiState.imageUploaded = false;
                apiState.quizSaved = false;
                apiState.readingGenerated = false;
                apiState.dynamicQuestions = [];
                apiState.demographics = { ageRange: '', gender: '' };
                appState.dynamicQuestions = [];
                appState.quizResponses = {};
                magicLinkHandled = false; // Allow new magic links
                teaserEventDispatched = false; // Reset the flag here as well

                // Also reset user data to clear the form
                appState.userData = {
                    name: '',
                    email: '',
                    identity: '',
                    age: '',
                    ageRange: '',
                    gdprConsent: false,
                    palmImage: null,
                    emailVerified: false
                };

                log('API state reset complete');
            }
        } catch (error) {
            logError('Error in goToPreviousStep wrapper:', error);
            // Still call original to prevent breaking navigation
        }
    };

    /**
     * OTP verification is now handled inline in the goToNextStep wrapper above
     * No need for separate button interception
     */

    // ========================================
    // INITIALIZATION
    // ========================================

    log('API Integration loaded successfully');

    // Debug smData availability
    if (typeof smData === 'undefined') {
        logError('CRITICAL: smData is undefined! WordPress localization failed.');
        return;
    }

    if (!smData.nonce) {
        logError('CRITICAL: smData.nonce is missing!');
        return;
    }

    log('Backend API URL:', smData.apiUrl);
    log('Nonce:', smData.nonce.substring(0, 10) + '...');
    log('Full nonce for debugging:', smData.nonce);

    // Expose API state for debugging
    window.smApiState = apiState;
    window.smApiMethods = {
        createLead,
        sendOtp,
        verifyOtp,
        uploadPalmImage,
        fetchDynamicQuestions,
        saveQuiz,
        generateReading
    };

    log('API methods exposed on window.smApiMethods for debugging');

    // Dashboard UI event handlers
    document.addEventListener('DOMContentLoaded', () => {
        const logoutBtn = document.getElementById('logout-btn');
        if (logoutBtn) {
            logoutBtn.addEventListener('click', async () => {
                log('Logout button clicked');
                try {
                    const response = await makeApiRequest('auth/logout', 'POST');
                    resetFlowState(false);
                    if (response.success && response.data.redirect_url) {
                        window.location.href = response.data.redirect_url;
                    } else {
                        // Fallback redirect
                        window.location.href = smData.homeUrl || '/';
                    }
                } catch (error) {
                    logError('Logout failed', error);
                    showToast('Logout failed. Please try again.', 'error');
                    resetFlowState(false);
                    // Force redirect even on failure
                    window.location.href = smData.homeUrl || '/';
                }
            });
        }

        const generateNewReadingBtn = document.getElementById('generate-new-reading-btn');
        if (generateNewReadingBtn) {
            generateNewReadingBtn.addEventListener('click', async () => {
                log('Generate New Reading button clicked');
                setButtonLoading(generateNewReadingBtn, true);

                try {
                    const response = await makeApiRequest('reading/start-new', 'GET');
                    if (response.success && response.data.proceed) {
                        // User has credits, proceed to start the flow
                        window.location.href = response.data.next_step_url || (smData.homeUrl || '/palm-reading');
                    } else {
                        throw new Error('Could not verify credits.');
                    }
                } catch (error) {
                    const redirectUrl = extractRedirectUrl(error);
                    if (redirectUrl) {
                        // No credits, redirect to shop
                        showToast(error.message || 'You need more credits to start a new reading.', 'error');
                        setTimeout(() => {
                            window.location.href = redirectUrl;
                        }, 2000);
                    } else {
                        // Generic error
                        logError('Generate New Reading failed', error);
                        showToast(error.message || 'An error occurred. Please try again.', 'error');
                        setButtonLoading(generateNewReadingBtn, false);
                    }
                }
            });
        }
    });

})();

//# sourceURL=sm-api-integration-js-after
</script>
<script src="https://sm-palm-reading.local/wp-content/plugins/elementor/assets/js/webpack.runtime.min.js?ver=3.34.0" id="elementor-webpack-runtime-js"></script>
<script src="https://sm-palm-reading.local/wp-content/plugins/elementor/assets/js/frontend-modules.min.js?ver=3.34.0" id="elementor-frontend-modules-js"></script>
<script src="https://sm-palm-reading.local/wp-includes/js/jquery/ui/core.min.js?ver=1.13.3" id="jquery-ui-core-js"></script>
<script id="elementor-frontend-js-before">
var elementorFrontendConfig = {"environmentMode":{"edit":false,"wpPreview":false,"isScriptDebug":false},"i18n":{"shareOnFacebook":"Share on Facebook","shareOnTwitter":"Share on Twitter","pinIt":"Pin it","download":"Download","downloadImage":"Download image","fullscreen":"Fullscreen","zoom":"Zoom","share":"Share","playVideo":"Play Video","previous":"Previous","next":"Next","close":"Close","a11yCarouselPrevSlideMessage":"Previous slide","a11yCarouselNextSlideMessage":"Next slide","a11yCarouselFirstSlideMessage":"This is the first slide","a11yCarouselLastSlideMessage":"This is the last slide","a11yCarouselPaginationBulletMessage":"Go to slide"},"is_rtl":false,"breakpoints":{"xs":0,"sm":480,"md":768,"lg":1025,"xl":1440,"xxl":1600},"responsive":{"breakpoints":{"mobile":{"label":"Mobile Portrait","value":767,"default_value":767,"direction":"max","is_enabled":true},"mobile_extra":{"label":"Mobile Landscape","value":880,"default_value":880,"direction":"max","is_enabled":false},"tablet":{"label":"Tablet Portrait","value":1024,"default_value":1024,"direction":"max","is_enabled":true},"tablet_extra":{"label":"Tablet Landscape","value":1200,"default_value":1200,"direction":"max","is_enabled":false},"laptop":{"label":"Laptop","value":1366,"default_value":1366,"direction":"max","is_enabled":false},"widescreen":{"label":"Widescreen","value":2400,"default_value":2400,"direction":"min","is_enabled":false}},"hasCustomBreakpoints":false},"version":"3.34.0","is_static":false,"experimentalFeatures":{"e_font_icon_svg":true,"additional_custom_breakpoints":true,"container":true,"e_optimized_markup":true,"e_pro_free_trial_popup":true,"nested-elements":true,"home_screen":true,"global_classes_should_enforce_capabilities":true,"e_variables":true,"cloud-library":true,"e_opt_in_v4_page":true,"e_interactions":true,"import-export-customization":true},"urls":{"assets":"https:\/\/sm-palm-reading.local\/wp-content\/plugins\/elementor\/assets\/","ajaxurl":"https:\/\/sm-palm-reading.local\/wp-admin\/admin-ajax.php","uploadUrl":"http:\/\/sm-palm-reading.local\/wp-content\/uploads"},"nonces":{"floatingButtonsClickTracking":"d640521a1b"},"swiperClass":"swiper","settings":{"page":[],"editorPreferences":[]},"kit":{"active_breakpoints":["viewport_mobile","viewport_tablet"],"global_image_lightbox":"yes","lightbox_enable_counter":"yes","lightbox_enable_fullscreen":"yes","lightbox_enable_zoom":"yes","lightbox_enable_share":"yes","lightbox_title_src":"title","lightbox_description_src":"description"},"post":{"id":65,"title":"sm-palm-reading","excerpt":"","featuredImage":false}};
//# sourceURL=elementor-frontend-js-before
</script>
<script src="https://sm-palm-reading.local/wp-content/plugins/elementor/assets/js/frontend.min.js?ver=3.34.0" id="elementor-frontend-js"></script><span id="elementor-device-mode" class="elementor-screen-only"></span>
<script id="wp-emoji-settings" type="application/json">
{"baseUrl":"https://s.w.org/images/core/emoji/17.0.2/72x72/","ext":".png","svgUrl":"https://s.w.org/images/core/emoji/17.0.2/svg/","svgExt":".svg","source":{"concatemoji":"https://sm-palm-reading.local/wp-includes/js/wp-emoji-release.min.js?ver=6.9"}}
</script>
<script type="module">
/*! This file is auto-generated */
const a=JSON.parse(document.getElementById("wp-emoji-settings").textContent),o=(window._wpemojiSettings=a,"wpEmojiSettingsSupports"),s=["flag","emoji"];function i(e){try{var t={supportTests:e,timestamp:(new Date).valueOf()};sessionStorage.setItem(o,JSON.stringify(t))}catch(e){}}function c(e,t,n){e.clearRect(0,0,e.canvas.width,e.canvas.height),e.fillText(t,0,0);t=new Uint32Array(e.getImageData(0,0,e.canvas.width,e.canvas.height).data);e.clearRect(0,0,e.canvas.width,e.canvas.height),e.fillText(n,0,0);const a=new Uint32Array(e.getImageData(0,0,e.canvas.width,e.canvas.height).data);return t.every((e,t)=>e===a[t])}function p(e,t){e.clearRect(0,0,e.canvas.width,e.canvas.height),e.fillText(t,0,0);var n=e.getImageData(16,16,1,1);for(let e=0;e<n.data.length;e++)if(0!==n.data[e])return!1;return!0}function u(e,t,n,a){switch(t){case"flag":return n(e,"\ud83c\udff3\ufe0f\u200d\u26a7\ufe0f","\ud83c\udff3\ufe0f\u200b\u26a7\ufe0f")?!1:!n(e,"\ud83c\udde8\ud83c\uddf6","\ud83c\udde8\u200b\ud83c\uddf6")&&!n(e,"\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc65\udb40\udc6e\udb40\udc67\udb40\udc7f","\ud83c\udff4\u200b\udb40\udc67\u200b\udb40\udc62\u200b\udb40\udc65\u200b\udb40\udc6e\u200b\udb40\udc67\u200b\udb40\udc7f");case"emoji":return!a(e,"\ud83e\u1fac8")}return!1}function f(e,t,n,a){let r;const o=(r="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope?new OffscreenCanvas(300,150):document.createElement("canvas")).getContext("2d",{willReadFrequently:!0}),s=(o.textBaseline="top",o.font="600 32px Arial",{});return e.forEach(e=>{s[e]=t(o,e,n,a)}),s}function r(e){var t=document.createElement("script");t.src=e,t.defer=!0,document.head.appendChild(t)}a.supports={everything:!0,everythingExceptFlag:!0},new Promise(t=>{let n=function(){try{var e=JSON.parse(sessionStorage.getItem(o));if("object"==typeof e&&"number"==typeof e.timestamp&&(new Date).valueOf()<e.timestamp+604800&&"object"==typeof e.supportTests)return e.supportTests}catch(e){}return null}();if(!n){if("undefined"!=typeof Worker&&"undefined"!=typeof OffscreenCanvas&&"undefined"!=typeof URL&&URL.createObjectURL&&"undefined"!=typeof Blob)try{var e="postMessage("+f.toString()+"("+[JSON.stringify(s),u.toString(),c.toString(),p.toString()].join(",")+"));",a=new Blob([e],{type:"text/javascript"});const r=new Worker(URL.createObjectURL(a),{name:"wpTestEmojiSupports"});return void(r.onmessage=e=>{i(n=e.data),r.terminate(),t(n)})}catch(e){}i(n=f(s,u,c,p))}t(n)}).then(e=>{for(const n in e)a.supports[n]=e[n],a.supports.everything=a.supports.everything&&a.supports[n],"flag"!==n&&(a.supports.everythingExceptFlag=a.supports.everythingExceptFlag&&a.supports[n]);var t;a.supports.everythingExceptFlag=a.supports.everythingExceptFlag&&!a.supports.flag,a.supports.everything||((t=a.source||{}).concatemoji?r(t.concatemoji):t.wpemoji&&t.twemoji&&(r(t.twemoji),r(t.wpemoji)))});
//# sourceURL=https://sm-palm-reading.local/wp-includes/js/wp-emoji-loader.min.js
</script>
	

<div class="sm-modal" id="sm-modal" aria-hidden="true" role="dialog" aria-modal="true" aria-label="Quick insight">
  <div class="sm-modal__backdrop" data-close="1"></div>
  <div class="sm-modal__panel" role="document">
    <button class="sm-modal__close" type="button" aria-label="Close" data-close="1">
      <i class="fas fa-times"></i>
    </button>
    <div class="sm-modal__content">
      <div class="sm-modal__badge" id="sm-modal-badge">Unlock Insight</div><h3 class="sm-modal__title" id="sm-modal-title">Title</h3>
      <p class="sm-modal__body" id="sm-modal-body">Body</p>
      <div class="sm-modal__hint" id="sm-modal-hint">Unlock the full report to access every insight instantly.</div>
      <div class="sm-modal__actions">
        <button class="action-btn btn-premium sm-modal__cta" type="button" data-cta="">
          <i class="fas fa-crown"></i> View Plans
        </button>
        <button class="action-btn btn-ghost sm-modal__secondary" type="button" data-close="1">
          Maybe later
        </button>
      </div>
    </div>
  </div>
</div></body></html>